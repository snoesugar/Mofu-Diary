<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>edit-itinerary編輯行程</title>
    <script type="module" crossorigin src="/Mofu-Diary/assets/main-CfYEHox9.js"></script>
    <link rel="stylesheet" crossorigin href="/Mofu-Diary/assets/main-9slOzLV2.css">
  </head>
  <body>

<div class="container has-bottom-pad bg-scene page-wrapper">
  <div class="row">
    <div class="col-12 d-flex flex-column ">
      <!-- 頂部：問候 -->
      <!-- <div class="d-flex justify-content-between align-items-start my-2"> -->
      <div id="greet" class="d-flex justify-content-between align-items-start mt-top">
        <div>
          <h1 class="text-primary-700 fw-bold fs-6 mb-1">Hi, Sarah</h1>
          <p class="fs-12 text-primary-700 mb-0">與 Mofu 相遇的第 17 天</p>
        </div>
        <a href="../pages/growth-record.html"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAxCAYAAABznEEcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAATFSURBVHgB7Vldcts2EF7wx5MZN41uEN6gcutk+khN43TyFPkEkU8Q+wSETtDoBFVPIPkp08YeqW+ZcX6UE4Q5QZTXiCSyS4ISRPEHlPjIb4YiCCwWWOwPFhBAixYtWrRoUQwGDWPCu51jsB0Twm4EhpPWGxD5+O2f8XdzaBiNCfGGn7rIzMNiF9l2yqnFNILo+in/MIYGcLAQ//FfBwaYNHkH6gO1Ew4PFWZvIV7zrmOD9TeycHcahfgSMTY3AJYCxFLWdhkwB9+/7HIT8xUEF8/4woc9sJcQiQD2DJTVR0bLCNgoAGP8jL/1i/rO+O9OCOElCvQcBXSUJn8Fq94+gtQWQmrgY8buRyYc8x6fL3X5kDABRAMGwlOqlyjISV1BagmR1UCy+uL8kIiTBAQ2wWK6KLU1YkANJD6wEQAd+uTQkEn9TeSDxVSL0tf0oS0ERSHViUkDvQLbp72Cnqq6FMQH/eN8U8PcZDw9aAshw2gMHHBYpIF/+W/9+2B9vg/219vhadzndvjYo296boaPX+T1k/xGeeNVz00DclUcKqP9+hZY4yJaEwwvdXoh2GXyFnxNoJZ3+q6obW1W5C+gAS0hGFj9zVc07ZWEUGUSJPAyW4da/FLUsccXuK+w0aY/aGnD0iHCMPg8LRtgjbLtt/zRX/jqo59M0UkvAgjHVG+CiDUR4fxwQq+SAa1BbGaCDYgezehqe0LGGPcROXnWnaEfkXBQOr8KyBA4k5+LJ/zuRG2Xacc6moQQnf/J30+L+N2gz+BSTNJvNLWrs+G7V1s03qkPjD2kMi7AyVN+t4ASVGoCs09H4JrGA+aYAhNGR10KU2mTNk3PPA0EqNWOUPkztrvKmLLgrwwAISaUsCifYwXUdDqPmcWCMb4+URkn9/8TqQWKSKRBfOJ3GqlwUbCdXaf0BhznaU3xq63xc6HlE2WQ9tpV68jERCYKYaTib7zTbz0em06/jCcljaxGMlFrx2aV54QkNSmK8Ywxj9qhYRjVBJGvfD4oo6Ud2QKbnNYpIOlg7jWZFezcyqhrzYrt8QvmWIEQTNUP3DLanzA5ZBnTykE3BGtSRoDO/3BTNnyoQKUQNqx8UHbR15hC59HRXqEhQDo1FyMXz2uR5rbmo5NgVgohHXetDQuCQR6dqNBSFuhfuTnUEdgvNzzFNWhAy7Ep4VMGf1lg09oHoiJ60oJQIpcBbKrBR08IUiklfvKzE4C1E31wZ71SaOJzNv5+or2AHrYV+2GJm+JFlscROyLtOAkN8//gd2PQgHYwRpsf4GTW6QVqp5dnr+Qz9+DesuioWtSeSW9oYheNC0G44Y9oEFd+7nUezkP23E6aO+N3rm7/WpsdZaiqWWHM/6ib8xeB+qsCJOcVc1CHR+3bDnnlgoOuD/a4Ewv+XQT/1NEKbYw/g+3hql8qk4nP7RXnlR3sde9EguA15Cx7b4TMpt9hNSoThnziiAUvhKDJb9IY0oABRq+uAEnfPSE1Qo7u5jTjviLw8J9mt6yDdvsAB3NFTkpCPkAmtI8AhIPvYilqIRsvoxXNwcm/xFA3ChXzaQgkDB43+3Q9CeUD4oUbaUjwpq75G/9/gkARh06E2f8nKJm04divc93ZokWLFi1aHIofO2vu3HGww2kAAAAASUVORK5CYII=" alt="icon_pet"></a>
      </div>
      <!-- 場景：背景圖 + 貓 + ZZZ -->
      <div class="mx-auto">
        <!-- ZZZ 泡泡：依你提供位置 -->
        <div class="speech p-1 px-2 d-inline-block bg-neutral-0 rounded-top-xs rounded-bottom-right-xs shadow-sm">
          <p class="fs-12 text-primary-600 mb-0 ">ZZZ.......</p>
        </div>

        <!-- 貓槽位：百分比等比縮放，不跑版 -->
        <div class="cat-slot">
          <img src="/Mofu-Diary/assets/cat-sleep-2-B9Y2Y-PO.png" alt="action_cat_sleep2">
        </div>
      </div>
  </div>
</div>
<aside id="relaxPanel" class="relax-panel">
  <div class="scene-footer d-flex align-items-start">
    <!-- 原本的小卡：tag-btn、.task-card 保持不動 -->
    <!-- ... 你的原始 .scene-footer 內容 ... -->
    <button class="tag-btn d-flex align-items-center">
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAwCAYAAAC4wJK5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANqSURBVHgB7ZjbSxRRHMe/Zy4VmGRhtye36AKR7XYR1qd28QJCUEF/wBb00ovrYxB0hHrWHnqS0Jd6EvRBEHTDDSIExVZ7KCp06aFSglZSMNbZ6ffT9cJiNjOe2SLmA4c5c+bMMN9zfr9zfr8DBAQEBAT4hMAOGJIXEoAesZDvbJGZLFwyKCMhHWYSsDLNcqIHHtHgEf4BDXo3faDVhNEND5gw+/h9/s6QrIvAI55FGDBCG3ciBC/Y9v71L8Cugkdcm9OgjIb4ulsshwu26C82Z/PQ43CJaS+nIUQN1wuwblrYleZ6ixzNwgWORQzJSESj6adqCP6TLQDXm+VYxklnRyLY/sl+R1AeAWvkdOSPxWUm96eOjnzCpBUIDgXs2XcIiqjKQ7vmpKPhpBM7ne2g34nG2zhQU4sfs9N4O9CJ6lNRnLnShlePb+HcjXvYe/g4luZn8X64C7lPb6AKz6vTVrCAz5PPVwQwB0/W48tUCkdrGzHx9C4Wvk5jqveBUgGMUhFTvQ9ReeQ46u88gbG7AlU1Z2nk51B9Ogo/USriSG3DysizAVafqsfC3AwWyLRYEBe/cOQTTvn2YZRMKIp3Ax3I/1wks5lamYmPqS4Yeyow8/IZlpcWoRqlInjUuZTyvegDLMgPXIugjSVHG9EkfIK+H6aLqxDEtYgC7MkmOR6DT6RkHW+qMTfvKHXsv8V/IUKpY/fJSNVeW0toQs81yLGe0nYh9DBFqy92kgBthbKZGJaXZCWMGfrRDvKbxOZnlTBfk7D7FLoc4wSI7N5TEvU7lImgKU0LFNpK21PyIgdxISptTXIsZkO0Uz1BomNQhDIRcTmebtjCTNYyNpqdLF8NaKt9bHhOR0vx3bEL0LLF6lXOCsknWvlGCBGGInwXQXtKmi6PBETShDVjbyRi81BEWZbYRjmW1FGxnwvt9j3cZtur5qWCsojg45i4TOe40G2S2wxh9EMRyvYJWjbXkz8ynct8zycYJgr9FuyRlLy09piyRLs97vJEYzuUiRD0w6VtJnal6WdzIzJ63oK1MgMkoL/oJ8pQJqJhm124OOpJ+EQQAP4reEiKRFh17FNCCC5xJMKCntk0ZRxGJFAGeGFw0s+ROfGZaDFwKxtulmFXp+KrEakWK7jMgd1Ao5rzYxkOCAgICPDEL7avHr5zvhSIAAAAAElFTkSuQmCC" alt="icon_calendar_date" class="" width="20" height="20">
      <span class="fs-9 text-primary-600 fw-bold">編輯放鬆行程</span>
    </button>
  
    <div class="task-card position-relative px-4 py-2 me-4 rounded-2 d-flex align-items-start flex-grow-1">
      <div class="flex-grow-1 pe-6">
        <div class="fs-13 fw-medium text-primary-500">已完成 2 / 4</div>
        <div class="progress progress-thin mt-1 rounded-pill" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="25">
          <div class="progress-bar rounded-pill" style="width:50%"></div><!--width:0%改動可改進度條百分比-->
        </div>
      </div>
      <div class="icon-badge position-absolute top-50 end-0 translate-middle-y me-2 d-flex align-items-center justify-content-center">
        <svg class="icon_cat_can" width="22" height="22" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M25.8766 10.2833H23.1347V9.83751C23.1347 9.07959 23.7288 8.5 24.5056 8.5C25.2825 8.5 25.8766 9.07959 25.8766 9.83751V10.2833ZM38.2039 33.2433H10.785V18.0849H38.2039V33.2433ZM9.88219 14.7417H39.1291C39.9059 14.7417 40.5 14.1175 40.5 13.4042C40.5 12.6463 39.9059 12.0667 39.1291 12.0667H9.88219C9.10532 12.0667 8.51125 12.6463 8.51125 13.4042C8.51125 14.1175 9.10532 14.7417 9.88219 14.7417ZM39.1178 36.5H9.87095C9.09408 36.5 8.5 37.0796 8.5 37.8375C8.5 38.5508 9.09408 39.175 9.87095 39.175H39.1178C39.8947 39.175 40.4888 38.5508 40.4888 37.8375C40.4888 37.0796 39.8947 36.5 39.1178 36.5Z" 
        fill="currentColor" stroke="currentColor"/><!--fill stroke 改 currentColor 才能在scss裡改色-->
        <path fill-rule="evenodd" clip-rule="evenodd" d="M33.9853 26.166C33.9853 25.9431 33.8939 25.6756 33.7111 25.5419C31.8375 23.8031 29.2327 22.7777 26.4908 22.7777C24.0688 22.7777 21.7382 23.5802 19.9102 25.0069L16.8485 22.3764C16.4829 22.0643 15.8888 22.1089 15.5689 22.4656C15.249 22.8223 15.2947 23.4018 15.6603 23.7139L18.5393 26.166L15.6603 28.6181C15.2947 28.9302 15.249 29.5098 15.5689 29.8665C15.7517 30.0894 16.0259 30.1786 16.2544 30.1786C16.4829 30.1786 16.6657 30.0894 16.8485 29.9556L19.9102 27.3252C21.6925 28.7519 24.0688 29.5544 26.4908 29.5544C29.187 29.5544 31.8375 28.5736 33.7111 26.7902C33.8939 26.6565 33.9853 26.389 33.9853 26.166ZM26.5365 27.771C24.6171 27.771 22.8349 27.1915 21.3726 26.166C22.7892 25.1406 24.6171 24.561 26.5365 24.561C28.4558 24.561 30.238 25.1406 31.7004 26.166C30.238 27.1915 28.4101 27.771 26.5365 27.771Z" fill="white"/>
        </svg>
      </div>
    </div>
  </div>
  <!-- 抽屜內容（在卡片下方，可放清單等；會自己捲動） -->
  <div class="scene-body">
    <!-- 「編輯行程」詳細內容 -->
    <div class="container has-bottom-pad body page-wrapper">
      <div class="row">
        <div class="col-12 d-flex flex-column">
          <div class="mt-4 mb-5 d-flex">
            <!--mood-picker-inline.ejs  -->
<div class="text-primary-600 pe-4">
  <h3 class="fs-11">今日心情</h3>
  <div class="dropdown" id="iconPicker">
    <button id="iconBtn" type="button"
            class="btn border-1 border-neutral-100 bg-neutral-0 p-4 rounded-3 d-inline-flex align-items-center gap-2"
            data-bs-toggle="dropdown"
            data-bs-display="static"
            aria-expanded="false">
      <span class="icon-slot" aria-hidden="true">
        <!-- 初始 SVG -->
        <svg width="30" height="30" viewBox="14 14 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M24.0024 18.0034C24.5547 18.0034 25.0024 18.4511 25.0024 19.0034V22.9985H28.9966C29.5488 22.9987 29.9966 23.4463 29.9966 23.9985C29.9966 24.5507 29.5488 24.9984 28.9966 24.9985H25.0024V28.9966C25.0024 29.5489 24.5547 29.9966 24.0024 29.9966C23.4503 29.9964 23.0024 29.5488 23.0024 28.9966V24.9985H19.0034C18.4511 24.9985 18.0034 24.5508 18.0034 23.9985C18.0034 23.4463 18.4511 22.9985 19.0034 22.9985H23.0024V19.0034C23.0024 18.4512 23.4503 18.0036 24.0024 18.0034Z" 
        fill="#BC8035"/>
        </svg>
      </span>
    </button>
  
    <div class="dropdown-menu p-2 shadow icon-option" style="min-width:60px;">
      <div class="d-flex">
        <button type="button"
          class="icon-option border-0 bg-neutral-0 d-inline-flex align-items-center p-1 me-2"
          data-key="cat_happy"
          data-label="cat_happy"
          aria-label="cat_happy"
          >
          <img height="40" width="40" src="/Mofu-Diary/assets/cat_happy-ShtQ3uwo.png" alt="cat_happy">
        </button>
        <button type="button"
          class="icon-option border-0 bg-neutral-0 d-inline-flex align-items-center p-1 me-2"
          data-key="cat_angry"
          data-label="cat_angry"
          aria-label="cat_angry"
          >
          <img height="40" width="40" src="/Mofu-Diary/assets/cat_angry-C9U1GFSi.png" alt="cat_angry">
        </button>
        <button type="button"
          class="icon-option border-0 bg-neutral-0 d-inline-flex align-items-center p-1 me-2"
          data-key="cat_cry"
          data-label="cat_cry"
          aria-label="cat_cry"
          >
          <img height="40" width="40" src="/Mofu-Diary/assets/cat_cry-B8CH2xKr.png" alt="cat_cry">
        </button>
        <button type="button"
          class="icon-option border-0 bg-neutral-0 d-inline-flex align-items-center p-1 me-2"
          data-key="cat_dizziness"
          data-label="cat_dizziness"
          aria-label="cat_dizziness"
          >
          <img height="40" width="40" src="/Mofu-Diary/assets/cat_dizziness-DvxzGnhx.png" alt="cat_dizziness">
        </button>
        <button type="button"
          class="icon-option border-0 bg-neutral-0 d-inline-flex align-items-center p-1"
          data-key="cat_calm"
          data-label="cat_calm"
          aria-label="cat_calm"
          >
          <img height="40" width="40" src="/Mofu-Diary/assets/cat_calm-B52feuo6.png" alt="cat_calm">
        </button>
      </div>
    </div>
    <!-- SVG 模板 -->
    <template id="icon-cat_happy">
      <img height="30" width="30" src="/Mofu-Diary/assets/cat_happy-ShtQ3uwo.png" alt="cat_happy">
    </template>
    <template id="icon-cat_angry">
      <img height="30" width="30" src="/Mofu-Diary/assets/cat_angry-C9U1GFSi.png" alt="cat_angry">
    </template>
    <template id="icon-cat_cry">
        <img height="30" width="30" src="/Mofu-Diary/assets/cat_cry-B8CH2xKr.png" alt="cat_cry">
    </template>
    <template id="icon-cat_dizziness">
        <img height="30" width="30" src="/Mofu-Diary/assets/cat_dizziness-DvxzGnhx.png" alt="cat_dizziness">
    </template>
    <template id="icon-cat_calm">
        <img height="30" width="30" src="/Mofu-Diary/assets/cat_calm-B52feuo6.png" alt="cat_calm">
    </template>
  </div>
</div>

<script>
      //今日心情更換圖示js
  document.addEventListener('click', (e) => {
   const opt = e.target.closest('#iconPicker .icon-option');
   if (!opt) return
   const key  = opt.dataset.key;
   const tpl  = document.getElementById(`icon-${key}`);
   const slot = document.querySelector('#iconBtn .icon-slot');
   const btn  = document.getElementById('iconBtn')
   if (tpl && slot) {
     slot.innerHTML = tpl.innerHTML;  // 回填 SVG
     btn.setAttribute('aria-label', `目前圖示：${opt.dataset.label || ''}`);
   }
  });
</script>            <!--energy-index.ejs  -->
<div class="fs-11 text-primary-600 d-flex flex-column flex-grow-1">
  <h3 class="fs-11">能量指數</h3>
  <button id="energyBtn" aria-label="能量指數" class="d-flex btn border-1 border-neutral-100 bg-neutral-0 p-3 rounded-3">
    <span class="icon-slot me-2" data-variant="energy" data-state="outline">
      <svg class="" width="44" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M24 38.1436C23.6308 38.1436 23.265 38.0787 22.9026 37.9488C22.5402 37.8188 22.2154 37.6171 21.9282 37.3436L19.3436 34.9847C16.3897 32.2906 13.7607 29.6513 11.4564 27.0667C9.15214 24.4821 8 21.6582 8 18.5949C8 16.1057 8.83473 14.0271 10.5042 12.359C12.1737 10.6906 14.2538 9.85645 16.7446 9.85645C18.1491 9.85645 19.4838 10.1607 20.7487 10.7693C22.0137 11.3778 23.0974 12.2359 24 13.3436C24.9299 12.2359 26.0201 11.3778 27.2706 10.7693C28.521 10.1607 29.8514 9.85645 31.2615 9.85645C33.7507 9.85645 35.8293 10.6906 37.4974 12.359C39.1658 14.0271 40 16.1057 40 18.5949C40 21.6582 38.8513 24.4855 36.5538 27.077C34.2564 29.6684 31.6239 32.3043 28.6564 34.9847L26.0718 37.3436C25.7846 37.6171 25.4598 37.8188 25.0974 37.9488C24.735 38.0787 24.3692 38.1436 24 38.1436ZM22.5346 16.4985C21.8295 15.3662 21.0017 14.4889 20.0513 13.8667C19.1009 13.2445 17.9932 12.9334 16.7282 12.9334C15.1137 12.9334 13.7682 13.4701 12.6917 14.5436C11.6152 15.6171 11.0769 16.9654 11.0769 18.5883C11.0769 19.9953 11.5761 21.49 12.5744 23.0724C13.5726 24.6549 14.7624 26.1915 16.1436 27.6821C17.5248 29.1727 18.947 30.5641 20.4103 31.8564C21.8735 33.1488 23.0701 34.212 24 35.0462C24.9299 34.212 26.1265 33.1488 27.5897 31.8564C29.053 30.5641 30.4752 29.1727 31.8564 27.6821C33.2376 26.1915 34.4274 24.6549 35.4256 23.0724C36.4239 21.49 36.9231 19.9953 36.9231 18.5883C36.9231 16.9654 36.3848 15.6171 35.3083 14.5436C34.2318 13.4701 32.8863 12.9334 31.2718 12.9334C30.0068 12.9334 28.8957 13.2445 27.9385 13.8667C26.9812 14.4889 26.15 15.3662 25.4449 16.4985C25.2748 16.7747 25.0612 16.9778 24.8041 17.1077C24.5467 17.2376 24.2766 17.3026 23.9938 17.3026C23.7108 17.3026 23.4393 17.2376 23.1795 17.1077C22.9197 16.9778 22.7047 16.7747 22.5346 16.4985Z" 
        fill="#EE6666"/>
      </svg>
    </span>
    <span class="icon-slot me-2">
      <svg class="" width="44" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M24 38.1436C23.6308 38.1436 23.265 38.0787 22.9026 37.9488C22.5402 37.8188 22.2154 37.6171 21.9282 37.3436L19.3436 34.9847C16.3897 32.2906 13.7607 29.6513 11.4564 27.0667C9.15214 24.4821 8 21.6582 8 18.5949C8 16.1057 8.83473 14.0271 10.5042 12.359C12.1737 10.6906 14.2538 9.85645 16.7446 9.85645C18.1491 9.85645 19.4838 10.1607 20.7487 10.7693C22.0137 11.3778 23.0974 12.2359 24 13.3436C24.9299 12.2359 26.0201 11.3778 27.2706 10.7693C28.521 10.1607 29.8514 9.85645 31.2615 9.85645C33.7507 9.85645 35.8293 10.6906 37.4974 12.359C39.1658 14.0271 40 16.1057 40 18.5949C40 21.6582 38.8513 24.4855 36.5538 27.077C34.2564 29.6684 31.6239 32.3043 28.6564 34.9847L26.0718 37.3436C25.7846 37.6171 25.4598 37.8188 25.0974 37.9488C24.735 38.0787 24.3692 38.1436 24 38.1436ZM22.5346 16.4985C21.8295 15.3662 21.0017 14.4889 20.0513 13.8667C19.1009 13.2445 17.9932 12.9334 16.7282 12.9334C15.1137 12.9334 13.7682 13.4701 12.6917 14.5436C11.6152 15.6171 11.0769 16.9654 11.0769 18.5883C11.0769 19.9953 11.5761 21.49 12.5744 23.0724C13.5726 24.6549 14.7624 26.1915 16.1436 27.6821C17.5248 29.1727 18.947 30.5641 20.4103 31.8564C21.8735 33.1488 23.0701 34.212 24 35.0462C24.9299 34.212 26.1265 33.1488 27.5897 31.8564C29.053 30.5641 30.4752 29.1727 31.8564 27.6821C33.2376 26.1915 34.4274 24.6549 35.4256 23.0724C36.4239 21.49 36.9231 19.9953 36.9231 18.5883C36.9231 16.9654 36.3848 15.6171 35.3083 14.5436C34.2318 13.4701 32.8863 12.9334 31.2718 12.9334C30.0068 12.9334 28.8957 13.2445 27.9385 13.8667C26.9812 14.4889 26.15 15.3662 25.4449 16.4985C25.2748 16.7747 25.0612 16.9778 24.8041 17.1077C24.5467 17.2376 24.2766 17.3026 23.9938 17.3026C23.7108 17.3026 23.4393 17.2376 23.1795 17.1077C22.9197 16.9778 22.7047 16.7747 22.5346 16.4985Z" 
        fill="#EE6666"/>
      </svg>
    </span>
    <span class="icon-slot me-2">
      <svg class="" width="44" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M24 38.1436C23.6308 38.1436 23.265 38.0787 22.9026 37.9488C22.5402 37.8188 22.2154 37.6171 21.9282 37.3436L19.3436 34.9847C16.3897 32.2906 13.7607 29.6513 11.4564 27.0667C9.15214 24.4821 8 21.6582 8 18.5949C8 16.1057 8.83473 14.0271 10.5042 12.359C12.1737 10.6906 14.2538 9.85645 16.7446 9.85645C18.1491 9.85645 19.4838 10.1607 20.7487 10.7693C22.0137 11.3778 23.0974 12.2359 24 13.3436C24.9299 12.2359 26.0201 11.3778 27.2706 10.7693C28.521 10.1607 29.8514 9.85645 31.2615 9.85645C33.7507 9.85645 35.8293 10.6906 37.4974 12.359C39.1658 14.0271 40 16.1057 40 18.5949C40 21.6582 38.8513 24.4855 36.5538 27.077C34.2564 29.6684 31.6239 32.3043 28.6564 34.9847L26.0718 37.3436C25.7846 37.6171 25.4598 37.8188 25.0974 37.9488C24.735 38.0787 24.3692 38.1436 24 38.1436ZM22.5346 16.4985C21.8295 15.3662 21.0017 14.4889 20.0513 13.8667C19.1009 13.2445 17.9932 12.9334 16.7282 12.9334C15.1137 12.9334 13.7682 13.4701 12.6917 14.5436C11.6152 15.6171 11.0769 16.9654 11.0769 18.5883C11.0769 19.9953 11.5761 21.49 12.5744 23.0724C13.5726 24.6549 14.7624 26.1915 16.1436 27.6821C17.5248 29.1727 18.947 30.5641 20.4103 31.8564C21.8735 33.1488 23.0701 34.212 24 35.0462C24.9299 34.212 26.1265 33.1488 27.5897 31.8564C29.053 30.5641 30.4752 29.1727 31.8564 27.6821C33.2376 26.1915 34.4274 24.6549 35.4256 23.0724C36.4239 21.49 36.9231 19.9953 36.9231 18.5883C36.9231 16.9654 36.3848 15.6171 35.3083 14.5436C34.2318 13.4701 32.8863 12.9334 31.2718 12.9334C30.0068 12.9334 28.8957 13.2445 27.9385 13.8667C26.9812 14.4889 26.15 15.3662 25.4449 16.4985C25.2748 16.7747 25.0612 16.9778 24.8041 17.1077C24.5467 17.2376 24.2766 17.3026 23.9938 17.3026C23.7108 17.3026 23.4393 17.2376 23.1795 17.1077C22.9197 16.9778 22.7047 16.7747 22.5346 16.4985Z" 
        fill="#EE6666"/>
      </svg>
    </span>
    <span class="icon-slot me-2">
      <svg class="" width="44" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M24 38.1436C23.6308 38.1436 23.265 38.0787 22.9026 37.9488C22.5402 37.8188 22.2154 37.6171 21.9282 37.3436L19.3436 34.9847C16.3897 32.2906 13.7607 29.6513 11.4564 27.0667C9.15214 24.4821 8 21.6582 8 18.5949C8 16.1057 8.83473 14.0271 10.5042 12.359C12.1737 10.6906 14.2538 9.85645 16.7446 9.85645C18.1491 9.85645 19.4838 10.1607 20.7487 10.7693C22.0137 11.3778 23.0974 12.2359 24 13.3436C24.9299 12.2359 26.0201 11.3778 27.2706 10.7693C28.521 10.1607 29.8514 9.85645 31.2615 9.85645C33.7507 9.85645 35.8293 10.6906 37.4974 12.359C39.1658 14.0271 40 16.1057 40 18.5949C40 21.6582 38.8513 24.4855 36.5538 27.077C34.2564 29.6684 31.6239 32.3043 28.6564 34.9847L26.0718 37.3436C25.7846 37.6171 25.4598 37.8188 25.0974 37.9488C24.735 38.0787 24.3692 38.1436 24 38.1436ZM22.5346 16.4985C21.8295 15.3662 21.0017 14.4889 20.0513 13.8667C19.1009 13.2445 17.9932 12.9334 16.7282 12.9334C15.1137 12.9334 13.7682 13.4701 12.6917 14.5436C11.6152 15.6171 11.0769 16.9654 11.0769 18.5883C11.0769 19.9953 11.5761 21.49 12.5744 23.0724C13.5726 24.6549 14.7624 26.1915 16.1436 27.6821C17.5248 29.1727 18.947 30.5641 20.4103 31.8564C21.8735 33.1488 23.0701 34.212 24 35.0462C24.9299 34.212 26.1265 33.1488 27.5897 31.8564C29.053 30.5641 30.4752 29.1727 31.8564 27.6821C33.2376 26.1915 34.4274 24.6549 35.4256 23.0724C36.4239 21.49 36.9231 19.9953 36.9231 18.5883C36.9231 16.9654 36.3848 15.6171 35.3083 14.5436C34.2318 13.4701 32.8863 12.9334 31.2718 12.9334C30.0068 12.9334 28.8957 13.2445 27.9385 13.8667C26.9812 14.4889 26.15 15.3662 25.4449 16.4985C25.2748 16.7747 25.0612 16.9778 24.8041 17.1077C24.5467 17.2376 24.2766 17.3026 23.9938 17.3026C23.7108 17.3026 23.4393 17.2376 23.1795 17.1077C22.9197 16.9778 22.7047 16.7747 22.5346 16.4985Z" 
        fill="#EE6666"/>
      </svg>
    </span>
    <span class="icon-slot">
      <svg class="" width="44" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M24 38.1436C23.6308 38.1436 23.265 38.0787 22.9026 37.9488C22.5402 37.8188 22.2154 37.6171 21.9282 37.3436L19.3436 34.9847C16.3897 32.2906 13.7607 29.6513 11.4564 27.0667C9.15214 24.4821 8 21.6582 8 18.5949C8 16.1057 8.83473 14.0271 10.5042 12.359C12.1737 10.6906 14.2538 9.85645 16.7446 9.85645C18.1491 9.85645 19.4838 10.1607 20.7487 10.7693C22.0137 11.3778 23.0974 12.2359 24 13.3436C24.9299 12.2359 26.0201 11.3778 27.2706 10.7693C28.521 10.1607 29.8514 9.85645 31.2615 9.85645C33.7507 9.85645 35.8293 10.6906 37.4974 12.359C39.1658 14.0271 40 16.1057 40 18.5949C40 21.6582 38.8513 24.4855 36.5538 27.077C34.2564 29.6684 31.6239 32.3043 28.6564 34.9847L26.0718 37.3436C25.7846 37.6171 25.4598 37.8188 25.0974 37.9488C24.735 38.0787 24.3692 38.1436 24 38.1436ZM22.5346 16.4985C21.8295 15.3662 21.0017 14.4889 20.0513 13.8667C19.1009 13.2445 17.9932 12.9334 16.7282 12.9334C15.1137 12.9334 13.7682 13.4701 12.6917 14.5436C11.6152 15.6171 11.0769 16.9654 11.0769 18.5883C11.0769 19.9953 11.5761 21.49 12.5744 23.0724C13.5726 24.6549 14.7624 26.1915 16.1436 27.6821C17.5248 29.1727 18.947 30.5641 20.4103 31.8564C21.8735 33.1488 23.0701 34.212 24 35.0462C24.9299 34.212 26.1265 33.1488 27.5897 31.8564C29.053 30.5641 30.4752 29.1727 31.8564 27.6821C33.2376 26.1915 34.4274 24.6549 35.4256 23.0724C36.4239 21.49 36.9231 19.9953 36.9231 18.5883C36.9231 16.9654 36.3848 15.6171 35.3083 14.5436C34.2318 13.4701 32.8863 12.9334 31.2718 12.9334C30.0068 12.9334 28.8957 13.2445 27.9385 13.8667C26.9812 14.4889 26.15 15.3662 25.4449 16.4985C25.2748 16.7747 25.0612 16.9778 24.8041 17.1077C24.5467 17.2376 24.2766 17.3026 23.9938 17.3026C23.7108 17.3026 23.4393 17.2376 23.1795 17.1077C22.9197 16.9778 22.7047 16.7747 22.5346 16.4985Z" 
        fill="#EE6666"/>
      </svg>
    </span>
  </button>
  <template id="energy-solid">
    <!-- 實心 SVG -->
    <svg width="44" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M24 38.1436C23.6308 38.1436 23.265 38.0787 22.9026 37.9488C22.5402 37.8188 22.2154 37.6171 21.9282 37.3436L19.3436 34.9847C16.3897 32.2906 13.7607 29.6513 11.4564 27.0667C9.15214 24.4821 8 21.6582 8 18.5949C8 16.106 8.83419 14.0274 10.5026 12.359C12.1709 10.6906 14.2496 9.85645 16.7385 9.85645C18.147 9.85645 19.4838 10.1607 20.7487 10.7693C22.0137 11.3778 23.0974 12.2359 24 13.3436C24.9299 12.2359 26.0205 11.3778 27.2718 10.7693C28.5231 10.1607 29.853 9.85645 31.2615 9.85645C33.7504 9.85645 35.8291 10.6906 37.4974 12.359C39.1658 14.0274 40 16.106 40 18.5949C40 21.6582 38.8513 24.4855 36.5538 27.077C34.2564 29.6684 31.6239 32.3043 28.6564 34.9847L26.0718 37.3436C25.7846 37.6171 25.4598 37.8188 25.0974 37.9488C24.735 38.0787 24.3692 38.1436 24 38.1436Z" fill="#EE6666"/>
    </svg>
  </template>
  <template id="energy-outline">
    <!-- 空心 SVG（不同 path） -->
    <svg class="" width="44" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M24 38.1436C23.6308 38.1436 23.265 38.0787 22.9026 37.9488C22.5402 37.8188 22.2154 37.6171 21.9282 37.3436L19.3436 34.9847C16.3897 32.2906 13.7607 29.6513 11.4564 27.0667C9.15214 24.4821 8 21.6582 8 18.5949C8 16.1057 8.83473 14.0271 10.5042 12.359C12.1737 10.6906 14.2538 9.85645 16.7446 9.85645C18.1491 9.85645 19.4838 10.1607 20.7487 10.7693C22.0137 11.3778 23.0974 12.2359 24 13.3436C24.9299 12.2359 26.0201 11.3778 27.2706 10.7693C28.521 10.1607 29.8514 9.85645 31.2615 9.85645C33.7507 9.85645 35.8293 10.6906 37.4974 12.359C39.1658 14.0271 40 16.1057 40 18.5949C40 21.6582 38.8513 24.4855 36.5538 27.077C34.2564 29.6684 31.6239 32.3043 28.6564 34.9847L26.0718 37.3436C25.7846 37.6171 25.4598 37.8188 25.0974 37.9488C24.735 38.0787 24.3692 38.1436 24 38.1436ZM22.5346 16.4985C21.8295 15.3662 21.0017 14.4889 20.0513 13.8667C19.1009 13.2445 17.9932 12.9334 16.7282 12.9334C15.1137 12.9334 13.7682 13.4701 12.6917 14.5436C11.6152 15.6171 11.0769 16.9654 11.0769 18.5883C11.0769 19.9953 11.5761 21.49 12.5744 23.0724C13.5726 24.6549 14.7624 26.1915 16.1436 27.6821C17.5248 29.1727 18.947 30.5641 20.4103 31.8564C21.8735 33.1488 23.0701 34.212 24 35.0462C24.9299 34.212 26.1265 33.1488 27.5897 31.8564C29.053 30.5641 30.4752 29.1727 31.8564 27.6821C33.2376 26.1915 34.4274 24.6549 35.4256 23.0724C36.4239 21.49 36.9231 19.9953 36.9231 18.5883C36.9231 16.9654 36.3848 15.6171 35.3083 14.5436C34.2318 13.4701 32.8863 12.9334 31.2718 12.9334C30.0068 12.9334 28.8957 13.2445 27.9385 13.8667C26.9812 14.4889 26.15 15.3662 25.4449 16.4985C25.2748 16.7747 25.0612 16.9778 24.8041 17.1077C24.5467 17.2376 24.2766 17.3026 23.9938 17.3026C23.7108 17.3026 23.4393 17.2376 23.1795 17.1077C22.9197 16.9778 22.7047 16.7747 22.5346 16.4985Z" 
      fill="#EE6666"/>
    </svg>
  </template>  
</div>

<script>
       // 愛心評分：點第 N 顆 => 前 N 顆實心；再點同一顆 => 清空
  document.addEventListener('click', (e) => {
    const btn   = e.target.closest('#energyBtn');
    const slot  = e.target.closest('#energyBtn .icon-slot');
    if (!btn || !slot) return;
  
    const slots = Array.from(btn.querySelectorAll('.icon-slot'));
    const idx   = slots.indexOf(slot);             // 第幾顆被點
    const solid = document.getElementById('energy-solid');
    const line  = document.getElementById('energy-outline');
    if (!solid || !line) return;
  
    // 目前連續「實心」的數量（由左到右）
    let filled = 0;
    for (const s of slots) {
      if ((s.dataset.state || 'outline') === 'solid') filled++;
      else break;
    }
  
    // 點同一顆（與目前 filled 相同）就清空，否則設為 idx+1 顆
    const target = (filled === idx + 1) ? 0 : (idx + 1);
  
    // 套用實心 / 空心
    slots.forEach((s, i) => {
      if (i < target) {
        s.innerHTML = solid.innerHTML;
        s.dataset.state = 'solid';
      } else {
        s.innerHTML = line.innerHTML;
        s.dataset.state = 'outline';
      }
    });
  
    // 無障礙說明
    btn.setAttribute('aria-label', `能量指數：${target} / ${slots.length}`);
  });
</script>          </div>
          <div class="mb-5 p-2 border border-1 border-primary-700 border-dotted rounded-3">
            <!--breathing-exercises-edit.ejs  -->
<h3 class="fs-11 text-primary-600 mb-2">呼吸練習</h3>
<p class="fs-12 text-primary-700 mb-0">你可以在這裡設定呼吸練習行程</p> <!--p的通用樣式可能錯了-->
<p class="fs-12 text-primary-700 mb-2">時常練習可以幫助你提升長期抗壓與復原能力</p><!--p的通用樣式可能錯了-->
<div class="d-flex justify-content-between btn border-1 border-neutral-100 bg-neutral-0 p-3 rounded-3 w-100 mb-2">
  <div class="d-flex justify-content-between align-items-center text-primary-700">
    <svg 
    width="48" height="49" 
    viewBox="0 0 48 49" 
    fill="none" xmlns="http://www.w3.org/2000/svg"><!--fill stroke 改 currentColor 才能在scss裡改色-->
    <mask id="path-1-outside-1_2658_32976" maskUnits="userSpaceOnUse" x="7" y="8.13818" width="34" height="32" fill="black">
    <rect fill="white" x="7" y="8.13818" width="34" height="32"/>
    <path d="M38.7302 21.582C39.3445 19.0314 39.5106 16.3276 39.2153 13.751C38.8884 10.894 38.0132 9.34857 36.6133 9.16156C36.4921 9.14598 36.3655 9.13818 36.2337 9.13818C34.5149 9.13818 32.3558 10.5329 30.8479 11.7017C30.1862 12.216 29.5061 12.8835 28.905 13.4705L28.8101 13.5614C27.1756 13.0965 25.4937 12.8601 23.8092 12.8601C23.2503 12.8601 22.6861 12.8861 22.1352 12.9407C21.165 13.0316 20.1606 13.2186 19.1457 13.4991C18.5947 12.9666 17.8856 12.3043 17.1132 11.7043C15.6105 10.5329 13.4541 9.13818 11.73 9.13818C11.6008 9.13818 11.4716 9.14598 11.3504 9.16156C9.24928 9.44467 8.8723 12.6861 8.74839 13.751C8.45314 16.325 8.62186 19.0392 9.23873 21.6053C8.21588 23.7637 7.81517 26.1013 8.07879 28.3714C8.43205 31.4102 9.96633 34.2076 12.3969 36.249C15.1281 38.5451 19.3539 39.8619 23.9911 39.8619C29.1976 39.8619 33.9165 38.1659 36.6133 35.327C40.1907 31.5635 40.9974 26.3065 38.7302 21.582ZM33.7029 35.6854C31.3119 37.3243 27.7793 38.2646 24.0148 38.2646C20.4427 38.2646 17.042 37.41 14.6852 35.9192C12.5446 34.566 10.9127 32.5608 10.1746 30.3869C11.2554 30.0103 12.4048 29.8674 13.4962 29.7557L13.5358 29.7505L13.5727 29.735C13.9049 29.5947 14.0999 29.2648 14.0551 28.9142C14.0103 28.561 13.7467 28.296 13.3802 28.2389C13.2906 28.2259 13.1878 28.2181 13.0586 28.2181C12.7845 28.2181 12.4602 28.2493 12.2256 28.2727L12.1439 28.2805C11.3187 28.3636 10.5173 28.548 9.75807 28.8311C9.6368 28.2103 9.62099 27.5818 9.63417 27.0909H9.64998C9.77389 27.0909 9.90043 27.0909 10.0243 27.0857C10.1456 27.0857 10.2669 27.0805 10.3881 27.0805C10.4936 27.0805 10.5964 27.0805 10.7018 27.0883C11.0366 27.1039 11.3925 27.1662 11.7352 27.2259C12.0595 27.2831 12.3943 27.3402 12.7186 27.361C12.7713 27.3636 12.824 27.3662 12.8741 27.3662C13.1983 27.3662 13.4277 27.2857 13.5753 27.1169C13.7098 26.961 13.7599 26.7506 13.7177 26.4909C13.6307 25.9039 12.8214 25.7662 12.3389 25.6831L12.2071 25.6598C11.44 25.5169 10.6755 25.4779 9.9347 25.439C9.86616 25.4364 9.80025 25.4312 9.73171 25.4286C9.92679 24.291 10.2906 23.1637 10.8126 22.0703C11.1263 22.0962 11.4426 22.1092 11.7537 22.1092C16.3671 22.1092 20.3267 19.408 21.6026 15.3847C21.6237 15.3224 21.6554 15.1873 21.6896 15.0367C21.7186 14.9146 21.7661 14.712 21.7977 14.5978C22.0297 14.5484 22.6334 14.4809 22.8311 14.4679C23.1027 14.4523 23.3821 14.4445 23.6642 14.4445C25.9788 14.4445 28.4147 14.9354 30.3497 15.7899C34.6177 17.6782 37.6204 21.3586 38.2531 25.4494C38.203 25.4494 38.1529 25.4494 38.1028 25.4494C37.3383 25.4494 36.6397 25.5039 35.9701 25.613C34.7522 25.8156 34.5571 25.9896 34.4833 26.0546C34.2539 26.2649 34.1827 26.5974 34.3014 26.9039C34.4174 27.1974 34.6783 27.3818 34.9842 27.3818H35.0079L35.0316 27.3766C36.1652 27.1688 37.1617 27.0701 38.0738 27.0701C38.1766 27.0701 38.2794 27.0701 38.3823 27.0753C38.3796 27.5948 38.3533 28.2103 38.2557 28.8311C37.6731 28.6259 37.0457 28.4337 36.3603 28.3324C36.1151 28.296 35.4929 28.2077 35 28.2077C34.8154 28.2077 34.6678 28.2181 34.5465 28.2441C34.2012 28.3142 33.956 28.6025 33.9376 28.961C33.9191 29.322 34.1326 29.6337 34.4727 29.7428L34.4965 29.7505L34.7495 29.7791C35.63 29.8778 36.5395 29.9817 37.3805 30.2466C37.4728 30.2778 37.6678 30.3479 37.8128 30.4051C37.0615 32.5063 35.6089 34.3738 33.7029 35.6802V35.6854ZM16.4699 14.525C16.4699 14.525 16.4541 14.5043 16.4435 14.4965C15.6764 13.7147 14.7485 13.0394 13.9602 12.6887C13.4251 12.4524 12.9927 12.3355 12.6342 12.3355C11.5059 12.3355 11.2475 13.4679 11.0946 14.5302C10.9075 15.8367 10.8996 17.2366 11.0735 18.6963C10.8547 19.0028 10.6597 19.2729 10.4725 19.5171C10.4593 19.4262 10.4435 19.3353 10.4303 19.2444C10.3987 19.0392 10.367 18.8444 10.3459 18.647C10.1693 16.9302 10.222 15.0185 10.4883 13.2653C10.8231 11.1122 11.3609 10.7771 11.5744 10.7355C11.6324 10.7251 11.6957 10.7174 11.7642 10.7174C12.4444 10.7174 13.4462 11.2784 13.8732 11.5199C14.9831 12.1381 16.0956 12.9692 17.353 14.1173L16.4646 14.525H16.4699ZM37.6177 18.647C37.5967 18.8418 37.5677 19.034 37.536 19.2288C37.5228 19.3119 37.5097 19.3976 37.4965 19.4833C37.4543 19.4262 37.4121 19.3664 37.3699 19.3067C37.2645 19.1742 37.1564 19.0444 37.0615 18.9327L36.8928 18.6963C37.0668 17.234 37.0589 15.8341 36.8691 14.5302C36.7162 13.4679 36.4578 12.3355 35.3295 12.3355C34.971 12.3355 34.5386 12.4498 34.0035 12.6887C33.2179 13.0394 32.2899 13.7147 31.5254 14.4913C31.5149 14.5017 31.5043 14.512 31.4964 14.525L30.608 14.1173C31.8655 12.9692 32.978 12.1407 34.0852 11.5199C34.5518 11.2602 35.5219 10.7174 36.1968 10.7174C36.2654 10.7174 36.3313 10.7226 36.3893 10.7355C36.8401 10.8264 37.246 11.7719 37.4728 13.2653C37.7416 15.0159 37.7944 16.9276 37.6177 18.647ZM32.5957 26.8156C32.7697 27.1272 32.7249 27.5454 32.6247 27.8363C32.2161 29.0103 31.0562 29.7661 29.6695 29.7661C28.2829 29.7661 27.0939 29.0155 26.6563 27.8545C26.5429 27.5558 26.4823 27.1246 26.6537 26.813C26.7538 26.6286 26.9199 26.5065 27.1361 26.4571C27.2231 26.4364 27.3075 26.4286 27.3839 26.4286C27.9243 26.4286 28.0957 26.8831 28.2222 27.2156C28.2855 27.3818 28.3488 27.5532 28.4463 27.6675C28.7284 27.9999 29.1554 28.1896 29.6221 28.1896C30.1915 28.1896 30.6924 27.9168 30.9586 27.4623C31.0034 27.3844 31.0404 27.2831 31.0799 27.174C31.188 26.8779 31.3514 26.4286 31.876 26.4286C31.9499 26.4286 32.0289 26.439 32.1107 26.4571C32.3242 26.5065 32.4929 26.6286 32.5957 26.813V26.8156ZM21.5183 26.9272C21.7134 27.4727 21.2705 28.2571 21.0253 28.5506C20.3715 29.3376 19.4199 29.7895 18.4181 29.7895C17.3346 29.7895 16.3618 29.27 15.7529 28.3662C15.5314 28.0389 15.2599 27.3454 15.4655 26.8753C15.5367 26.7169 15.6896 26.5143 16.0297 26.4571C16.1035 26.4442 16.1747 26.439 16.2379 26.439C16.7994 26.439 16.9365 26.8753 17.0262 27.1662C17.0578 27.2649 17.0868 27.3558 17.1237 27.4337C17.3636 27.8987 17.8856 28.187 18.4866 28.187C19.0877 28.187 19.5569 27.9246 19.7995 27.4883C19.8416 27.413 19.8759 27.3117 19.9128 27.2026C20.0156 26.8987 20.1685 26.4364 20.7169 26.4364C20.7854 26.4364 20.8592 26.4442 20.9357 26.4597C21.3048 26.5351 21.455 26.7558 21.5183 26.9298V26.9272ZM25.4568 33.8569C25.4568 34.8751 24.803 35.6984 23.999 35.6984C23.1949 35.6984 22.5411 34.8751 22.5411 33.8569C22.5411 32.8388 23.1949 32.0154 23.999 32.0154C24.803 32.0154 25.4568 32.8388 25.4568 33.8569Z"/>
    <path d="M22.7995 30.3673C22.2248 29.8031 22.0798 28.6567 23.0394 28.4108C23.5508 28.2814 25.0192 28.2685 25.4568 28.5506C26.1528 28.9957 25.7995 30.0619 25.2486 30.4786C25.0614 30.6183 24.6633 30.8279 24.6633 30.8279C23.8399 30.9781 23.4612 30.7684 23.4612 30.7684C23.4612 30.7684 22.9761 30.5381 22.8021 30.3673H22.7995Z"/>
    </mask>
    <path d="M38.7302 21.582C39.3445 19.0314 39.5106 16.3276 39.2153 13.751C38.8884 10.894 38.0132 9.34857 36.6133 9.16156C36.4921 9.14598 36.3655 9.13818 36.2337 9.13818C34.5149 9.13818 32.3558 10.5329 30.8479 11.7017C30.1862 12.216 29.5061 12.8835 28.905 13.4705L28.8101 13.5614C27.1756 13.0965 25.4937 12.8601 23.8092 12.8601C23.2503 12.8601 22.6861 12.8861 22.1352 12.9407C21.165 13.0316 20.1606 13.2186 19.1457 13.4991C18.5947 12.9666 17.8856 12.3043 17.1132 11.7043C15.6105 10.5329 13.4541 9.13818 11.73 9.13818C11.6008 9.13818 11.4716 9.14598 11.3504 9.16156C9.24928 9.44467 8.8723 12.6861 8.74839 13.751C8.45314 16.325 8.62186 19.0392 9.23873 21.6053C8.21588 23.7637 7.81517 26.1013 8.07879 28.3714C8.43205 31.4102 9.96633 34.2076 12.3969 36.249C15.1281 38.5451 19.3539 39.8619 23.9911 39.8619C29.1976 39.8619 33.9165 38.1659 36.6133 35.327C40.1907 31.5635 40.9974 26.3065 38.7302 21.582ZM33.7029 35.6854C31.3119 37.3243 27.7793 38.2646 24.0148 38.2646C20.4427 38.2646 17.042 37.41 14.6852 35.9192C12.5446 34.566 10.9127 32.5608 10.1746 30.3869C11.2554 30.0103 12.4048 29.8674 13.4962 29.7557L13.5358 29.7505L13.5727 29.735C13.9049 29.5947 14.0999 29.2648 14.0551 28.9142C14.0103 28.561 13.7467 28.296 13.3802 28.2389C13.2906 28.2259 13.1878 28.2181 13.0586 28.2181C12.7845 28.2181 12.4602 28.2493 12.2256 28.2727L12.1439 28.2805C11.3187 28.3636 10.5173 28.548 9.75807 28.8311C9.6368 28.2103 9.62099 27.5818 9.63417 27.0909H9.64998C9.77389 27.0909 9.90043 27.0909 10.0243 27.0857C10.1456 27.0857 10.2669 27.0805 10.3881 27.0805C10.4936 27.0805 10.5964 27.0805 10.7018 27.0883C11.0366 27.1039 11.3925 27.1662 11.7352 27.2259C12.0595 27.2831 12.3943 27.3402 12.7186 27.361C12.7713 27.3636 12.824 27.3662 12.8741 27.3662C13.1983 27.3662 13.4277 27.2857 13.5753 27.1169C13.7098 26.961 13.7599 26.7506 13.7177 26.4909C13.6307 25.9039 12.8214 25.7662 12.3389 25.6831L12.2071 25.6598C11.44 25.5169 10.6755 25.4779 9.9347 25.439C9.86616 25.4364 9.80025 25.4312 9.73171 25.4286C9.92679 24.291 10.2906 23.1637 10.8126 22.0703C11.1263 22.0962 11.4426 22.1092 11.7537 22.1092C16.3671 22.1092 20.3267 19.408 21.6026 15.3847C21.6237 15.3224 21.6554 15.1873 21.6896 15.0367C21.7186 14.9146 21.7661 14.712 21.7977 14.5978C22.0297 14.5484 22.6334 14.4809 22.8311 14.4679C23.1027 14.4523 23.3821 14.4445 23.6642 14.4445C25.9788 14.4445 28.4147 14.9354 30.3497 15.7899C34.6177 17.6782 37.6204 21.3586 38.2531 25.4494C38.203 25.4494 38.1529 25.4494 38.1028 25.4494C37.3383 25.4494 36.6397 25.5039 35.9701 25.613C34.7522 25.8156 34.5571 25.9896 34.4833 26.0546C34.2539 26.2649 34.1827 26.5974 34.3014 26.9039C34.4174 27.1974 34.6783 27.3818 34.9842 27.3818H35.0079L35.0316 27.3766C36.1652 27.1688 37.1617 27.0701 38.0738 27.0701C38.1766 27.0701 38.2794 27.0701 38.3823 27.0753C38.3796 27.5948 38.3533 28.2103 38.2557 28.8311C37.6731 28.6259 37.0457 28.4337 36.3603 28.3324C36.1151 28.296 35.4929 28.2077 35 28.2077C34.8154 28.2077 34.6678 28.2181 34.5465 28.2441C34.2012 28.3142 33.956 28.6025 33.9376 28.961C33.9191 29.322 34.1326 29.6337 34.4727 29.7428L34.4965 29.7505L34.7495 29.7791C35.63 29.8778 36.5395 29.9817 37.3805 30.2466C37.4728 30.2778 37.6678 30.3479 37.8128 30.4051C37.0615 32.5063 35.6089 34.3738 33.7029 35.6802V35.6854ZM16.4699 14.525C16.4699 14.525 16.4541 14.5043 16.4435 14.4965C15.6764 13.7147 14.7485 13.0394 13.9602 12.6887C13.4251 12.4524 12.9927 12.3355 12.6342 12.3355C11.5059 12.3355 11.2475 13.4679 11.0946 14.5302C10.9075 15.8367 10.8996 17.2366 11.0735 18.6963C10.8547 19.0028 10.6597 19.2729 10.4725 19.5171C10.4593 19.4262 10.4435 19.3353 10.4303 19.2444C10.3987 19.0392 10.367 18.8444 10.3459 18.647C10.1693 16.9302 10.222 15.0185 10.4883 13.2653C10.8231 11.1122 11.3609 10.7771 11.5744 10.7355C11.6324 10.7251 11.6957 10.7174 11.7642 10.7174C12.4444 10.7174 13.4462 11.2784 13.8732 11.5199C14.9831 12.1381 16.0956 12.9692 17.353 14.1173L16.4646 14.525H16.4699ZM37.6177 18.647C37.5967 18.8418 37.5677 19.034 37.536 19.2288C37.5228 19.3119 37.5097 19.3976 37.4965 19.4833C37.4543 19.4262 37.4121 19.3664 37.3699 19.3067C37.2645 19.1742 37.1564 19.0444 37.0615 18.9327L36.8928 18.6963C37.0668 17.234 37.0589 15.8341 36.8691 14.5302C36.7162 13.4679 36.4578 12.3355 35.3295 12.3355C34.971 12.3355 34.5386 12.4498 34.0035 12.6887C33.2179 13.0394 32.2899 13.7147 31.5254 14.4913C31.5149 14.5017 31.5043 14.512 31.4964 14.525L30.608 14.1173C31.8655 12.9692 32.978 12.1407 34.0852 11.5199C34.5518 11.2602 35.5219 10.7174 36.1968 10.7174C36.2654 10.7174 36.3313 10.7226 36.3893 10.7355C36.8401 10.8264 37.246 11.7719 37.4728 13.2653C37.7416 15.0159 37.7944 16.9276 37.6177 18.647ZM32.5957 26.8156C32.7697 27.1272 32.7249 27.5454 32.6247 27.8363C32.2161 29.0103 31.0562 29.7661 29.6695 29.7661C28.2829 29.7661 27.0939 29.0155 26.6563 27.8545C26.5429 27.5558 26.4823 27.1246 26.6537 26.813C26.7538 26.6286 26.9199 26.5065 27.1361 26.4571C27.2231 26.4364 27.3075 26.4286 27.3839 26.4286C27.9243 26.4286 28.0957 26.8831 28.2222 27.2156C28.2855 27.3818 28.3488 27.5532 28.4463 27.6675C28.7284 27.9999 29.1554 28.1896 29.6221 28.1896C30.1915 28.1896 30.6924 27.9168 30.9586 27.4623C31.0034 27.3844 31.0404 27.2831 31.0799 27.174C31.188 26.8779 31.3514 26.4286 31.876 26.4286C31.9499 26.4286 32.0289 26.439 32.1107 26.4571C32.3242 26.5065 32.4929 26.6286 32.5957 26.813V26.8156ZM21.5183 26.9272C21.7134 27.4727 21.2705 28.2571 21.0253 28.5506C20.3715 29.3376 19.4199 29.7895 18.4181 29.7895C17.3346 29.7895 16.3618 29.27 15.7529 28.3662C15.5314 28.0389 15.2599 27.3454 15.4655 26.8753C15.5367 26.7169 15.6896 26.5143 16.0297 26.4571C16.1035 26.4442 16.1747 26.439 16.2379 26.439C16.7994 26.439 16.9365 26.8753 17.0262 27.1662C17.0578 27.2649 17.0868 27.3558 17.1237 27.4337C17.3636 27.8987 17.8856 28.187 18.4866 28.187C19.0877 28.187 19.5569 27.9246 19.7995 27.4883C19.8416 27.413 19.8759 27.3117 19.9128 27.2026C20.0156 26.8987 20.1685 26.4364 20.7169 26.4364C20.7854 26.4364 20.8592 26.4442 20.9357 26.4597C21.3048 26.5351 21.455 26.7558 21.5183 26.9298V26.9272ZM25.4568 33.8569C25.4568 34.8751 24.803 35.6984 23.999 35.6984C23.1949 35.6984 22.5411 34.8751 22.5411 33.8569C22.5411 32.8388 23.1949 32.0154 23.999 32.0154C24.803 32.0154 25.4568 32.8388 25.4568 33.8569Z" fill="currentColor"/>
    <path d="M22.7995 30.3673C22.2248 29.8031 22.0798 28.6567 23.0394 28.4108C23.5508 28.2814 25.0192 28.2685 25.4568 28.5506C26.1528 28.9957 25.7995 30.0619 25.2486 30.4786C25.0614 30.6183 24.6633 30.8279 24.6633 30.8279C23.8399 30.9781 23.4612 30.7684 23.4612 30.7684C23.4612 30.7684 22.9761 30.5381 22.8021 30.3673H22.7995Z" fill="currentColor"/>
    <path d="M38.7302 21.582C39.3445 19.0314 39.5106 16.3276 39.2153 13.751C38.8884 10.894 38.0132 9.34857 36.6133 9.16156C36.4921 9.14598 36.3655 9.13818 36.2337 9.13818C34.5149 9.13818 32.3558 10.5329 30.8479 11.7017C30.1862 12.216 29.5061 12.8835 28.905 13.4705L28.8101 13.5614C27.1756 13.0965 25.4937 12.8601 23.8092 12.8601C23.2503 12.8601 22.6861 12.8861 22.1352 12.9407C21.165 13.0316 20.1606 13.2186 19.1457 13.4991C18.5947 12.9666 17.8856 12.3043 17.1132 11.7043C15.6105 10.5329 13.4541 9.13818 11.73 9.13818C11.6008 9.13818 11.4716 9.14598 11.3504 9.16156C9.24928 9.44467 8.8723 12.6861 8.74839 13.751C8.45314 16.325 8.62186 19.0392 9.23873 21.6053C8.21588 23.7637 7.81517 26.1013 8.07879 28.3714C8.43205 31.4102 9.96633 34.2076 12.3969 36.249C15.1281 38.5451 19.3539 39.8619 23.9911 39.8619C29.1976 39.8619 33.9165 38.1659 36.6133 35.327C40.1907 31.5635 40.9974 26.3065 38.7302 21.582ZM33.7029 35.6854C31.3119 37.3243 27.7793 38.2646 24.0148 38.2646C20.4427 38.2646 17.042 37.41 14.6852 35.9192C12.5446 34.566 10.9127 32.5608 10.1746 30.3869C11.2554 30.0103 12.4048 29.8674 13.4962 29.7557L13.5358 29.7505L13.5727 29.735C13.9049 29.5947 14.0999 29.2648 14.0551 28.9142C14.0103 28.561 13.7467 28.296 13.3802 28.2389C13.2906 28.2259 13.1878 28.2181 13.0586 28.2181C12.7845 28.2181 12.4602 28.2493 12.2256 28.2727L12.1439 28.2805C11.3187 28.3636 10.5173 28.548 9.75807 28.8311C9.6368 28.2103 9.62099 27.5818 9.63417 27.0909H9.64998C9.77389 27.0909 9.90043 27.0909 10.0243 27.0857C10.1456 27.0857 10.2669 27.0805 10.3881 27.0805C10.4936 27.0805 10.5964 27.0805 10.7018 27.0883C11.0366 27.1039 11.3925 27.1662 11.7352 27.2259C12.0595 27.2831 12.3943 27.3402 12.7186 27.361C12.7713 27.3636 12.824 27.3662 12.8741 27.3662C13.1983 27.3662 13.4277 27.2857 13.5753 27.1169C13.7098 26.961 13.7599 26.7506 13.7177 26.4909C13.6307 25.9039 12.8214 25.7662 12.3389 25.6831L12.2071 25.6598C11.44 25.5169 10.6755 25.4779 9.9347 25.439C9.86616 25.4364 9.80025 25.4312 9.73171 25.4286C9.92679 24.291 10.2906 23.1637 10.8126 22.0703C11.1263 22.0962 11.4426 22.1092 11.7537 22.1092C16.3671 22.1092 20.3267 19.408 21.6026 15.3847C21.6237 15.3224 21.6554 15.1873 21.6896 15.0367C21.7186 14.9146 21.7661 14.712 21.7977 14.5978C22.0297 14.5484 22.6334 14.4809 22.8311 14.4679C23.1027 14.4523 23.3821 14.4445 23.6642 14.4445C25.9788 14.4445 28.4147 14.9354 30.3497 15.7899C34.6177 17.6782 37.6204 21.3586 38.2531 25.4494C38.203 25.4494 38.1529 25.4494 38.1028 25.4494C37.3383 25.4494 36.6397 25.5039 35.9701 25.613C34.7522 25.8156 34.5571 25.9896 34.4833 26.0546C34.2539 26.2649 34.1827 26.5974 34.3014 26.9039C34.4174 27.1974 34.6783 27.3818 34.9842 27.3818H35.0079L35.0316 27.3766C36.1652 27.1688 37.1617 27.0701 38.0738 27.0701C38.1766 27.0701 38.2794 27.0701 38.3823 27.0753C38.3796 27.5948 38.3533 28.2103 38.2557 28.8311C37.6731 28.6259 37.0457 28.4337 36.3603 28.3324C36.1151 28.296 35.4929 28.2077 35 28.2077C34.8154 28.2077 34.6678 28.2181 34.5465 28.2441C34.2012 28.3142 33.956 28.6025 33.9376 28.961C33.9191 29.322 34.1326 29.6337 34.4727 29.7428L34.4965 29.7505L34.7495 29.7791C35.63 29.8778 36.5395 29.9817 37.3805 30.2466C37.4728 30.2778 37.6678 30.3479 37.8128 30.4051C37.0615 32.5063 35.6089 34.3738 33.7029 35.6802V35.6854ZM16.4699 14.525C16.4699 14.525 16.4541 14.5043 16.4435 14.4965C15.6764 13.7147 14.7485 13.0394 13.9602 12.6887C13.4251 12.4524 12.9927 12.3355 12.6342 12.3355C11.5059 12.3355 11.2475 13.4679 11.0946 14.5302C10.9075 15.8367 10.8996 17.2366 11.0735 18.6963C10.8547 19.0028 10.6597 19.2729 10.4725 19.5171C10.4593 19.4262 10.4435 19.3353 10.4303 19.2444C10.3987 19.0392 10.367 18.8444 10.3459 18.647C10.1693 16.9302 10.222 15.0185 10.4883 13.2653C10.8231 11.1122 11.3609 10.7771 11.5744 10.7355C11.6324 10.7251 11.6957 10.7174 11.7642 10.7174C12.4444 10.7174 13.4462 11.2784 13.8732 11.5199C14.9831 12.1381 16.0956 12.9692 17.353 14.1173L16.4646 14.525H16.4699ZM37.6177 18.647C37.5967 18.8418 37.5677 19.034 37.536 19.2288C37.5228 19.3119 37.5097 19.3976 37.4965 19.4833C37.4543 19.4262 37.4121 19.3664 37.3699 19.3067C37.2645 19.1742 37.1564 19.0444 37.0615 18.9327L36.8928 18.6963C37.0668 17.234 37.0589 15.8341 36.8691 14.5302C36.7162 13.4679 36.4578 12.3355 35.3295 12.3355C34.971 12.3355 34.5386 12.4498 34.0035 12.6887C33.2179 13.0394 32.2899 13.7147 31.5254 14.4913C31.5149 14.5017 31.5043 14.512 31.4964 14.525L30.608 14.1173C31.8655 12.9692 32.978 12.1407 34.0852 11.5199C34.5518 11.2602 35.5219 10.7174 36.1968 10.7174C36.2654 10.7174 36.3313 10.7226 36.3893 10.7355C36.8401 10.8264 37.246 11.7719 37.4728 13.2653C37.7416 15.0159 37.7944 16.9276 37.6177 18.647ZM32.5957 26.8156C32.7697 27.1272 32.7249 27.5454 32.6247 27.8363C32.2161 29.0103 31.0562 29.7661 29.6695 29.7661C28.2829 29.7661 27.0939 29.0155 26.6563 27.8545C26.5429 27.5558 26.4823 27.1246 26.6537 26.813C26.7538 26.6286 26.9199 26.5065 27.1361 26.4571C27.2231 26.4364 27.3075 26.4286 27.3839 26.4286C27.9243 26.4286 28.0957 26.8831 28.2222 27.2156C28.2855 27.3818 28.3488 27.5532 28.4463 27.6675C28.7284 27.9999 29.1554 28.1896 29.6221 28.1896C30.1915 28.1896 30.6924 27.9168 30.9586 27.4623C31.0034 27.3844 31.0404 27.2831 31.0799 27.174C31.188 26.8779 31.3514 26.4286 31.876 26.4286C31.9499 26.4286 32.0289 26.439 32.1107 26.4571C32.3242 26.5065 32.4929 26.6286 32.5957 26.813V26.8156ZM21.5183 26.9272C21.7134 27.4727 21.2705 28.2571 21.0253 28.5506C20.3715 29.3376 19.4199 29.7895 18.4181 29.7895C17.3346 29.7895 16.3618 29.27 15.7529 28.3662C15.5314 28.0389 15.2599 27.3454 15.4655 26.8753C15.5367 26.7169 15.6896 26.5143 16.0297 26.4571C16.1035 26.4442 16.1747 26.439 16.2379 26.439C16.7994 26.439 16.9365 26.8753 17.0262 27.1662C17.0578 27.2649 17.0868 27.3558 17.1237 27.4337C17.3636 27.8987 17.8856 28.187 18.4866 28.187C19.0877 28.187 19.5569 27.9246 19.7995 27.4883C19.8416 27.413 19.8759 27.3117 19.9128 27.2026C20.0156 26.8987 20.1685 26.4364 20.7169 26.4364C20.7854 26.4364 20.8592 26.4442 20.9357 26.4597C21.3048 26.5351 21.455 26.7558 21.5183 26.9298V26.9272ZM25.4568 33.8569C25.4568 34.8751 24.803 35.6984 23.999 35.6984C23.1949 35.6984 22.5411 34.8751 22.5411 33.8569C22.5411 32.8388 23.1949 32.0154 23.999 32.0154C24.803 32.0154 25.4568 32.8388 25.4568 33.8569Z" stroke="currentColor" stroke-width="0.2" mask="url(#path-1-outside-1_2658_32976)"/>
    <path d="M22.7995 30.3673C22.2248 29.8031 22.0798 28.6567 23.0394 28.4108C23.5508 28.2814 25.0192 28.2685 25.4568 28.5506C26.1528 28.9957 25.7995 30.0619 25.2486 30.4786C25.0614 30.6183 24.6633 30.8279 24.6633 30.8279C23.8399 30.9781 23.4612 30.7684 23.4612 30.7684C23.4612 30.7684 22.9761 30.5381 22.8021 30.3673H22.7995Z" stroke="currentColor" stroke-width="0.2" mask="url(#path-1-outside-1_2658_32976)"/>
    </svg>
    <h6 class="mb-0 ms-2 fs-11">平衡呼吸</h6>
  </div>
  <div class="d-flex align-items-center">
    <div class="d-flex flex-column align-items-end me-2">
      <p class="mb-0 fs-11 text-primary-600">每天</p>
      <div class="d-flex">
        <p class="mb-0 fs-11 text-primary-700">練習</p>
        <p class="mb-0 fs-11 text-primary-600">5</p>
        <p class="mb-0 fs-11 text-primary-700">分鐘</p>
      </div>  
    </div>
    <a href="javascript:void(0)" id="breath-edit-Btn" class="js-breath-edit-trigger"><!--js-breath-edit-trigger共用兩顆觸發鈕 → 共用同一抽屜-->
      <svg class="bg-primary-50 btn border border-1 p-0 rounded-2 border-primary-200" width="36" height="36" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11.4286 36.5714H13.8514L31.7714 18.6743L29.3257 16.2286L11.4286 34.1714V36.5714ZM9.71429 40C9.2419 40 8.8381 39.8324 8.50286 39.4971C8.16762 39.1619 8 38.7581 8 38.2857V34.1458C8 33.6905 8.08747 33.253 8.2624 32.8334C8.43733 32.4134 8.6851 32.0442 9.00571 31.7257L31.7714 8.98286C32.1061 8.66956 32.4754 8.42743 32.8795 8.25646C33.2837 8.08549 33.7138 8 34.1701 8C34.6263 8 35.0682 8.08762 35.4958 8.26286C35.9234 8.4381 36.3048 8.69333 36.64 9.02857L39.0171 11.4286C39.3524 11.7486 39.6 12.1181 39.76 12.5371C39.92 12.9562 40 13.3832 40 13.8181C40 14.2822 39.9217 14.7191 39.765 15.1287C39.6084 15.5383 39.3591 15.9125 39.0171 16.2514L16.2743 38.9943C15.957 39.3149 15.5893 39.5627 15.1712 39.7376C14.7528 39.9125 14.3128 40 13.8514 40H9.71429ZM30.5371 17.4629L29.3257 16.2286L31.7714 18.6743L30.5371 17.4629Z" fill="#BC8035"/>
      </svg>
    </a>
  </div>
</div>
<div class="d-flex btn border-1 border-neutral-100 bg-neutral-0 p-3 rounded-3 w-100" data-role="add-card"><!--【新增 data-role】-->
  <div class="p-0 d-flex justify-content-between align-items-center text-primary-700">
    <a href="javascript:void(0)" id="breath-edit-Btn" class="btn p-2 d-flex align-items-center js-breath-edit-trigger">
      <svg class="bg-primary-50 btn border border-1 p-0 rounded-1 border-primary-200" width="36" height="36" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M24.0024 18.0034C24.5547 18.0034 25.0024 18.4511 25.0024 19.0034V22.9985H28.9966C29.5488 22.9987 29.9966 23.4463 29.9966 23.9985C29.9966 24.5507 29.5488 24.9984 28.9966 24.9985H25.0024V28.9966C25.0024 29.5489 24.5547 29.9966 24.0024 29.9966C23.4503 29.9964 23.0024 29.5488 23.0024 28.9966V24.9985H19.0034C18.4511 24.9985 18.0034 24.5508 18.0034 23.9985C18.0034 23.4463 18.4511 22.9985 19.0034 22.9985H23.0024V19.0034C23.0024 18.4512 23.4503 18.0036 24.0024 18.0034Z" fill="#BC8035"/>
      </svg>
      <h6 class="mb-0 ms-4 fs-11 text-primary-700">新增呼吸練習</h6>
    </a>
  </div>
</div>

  <!-- 2) 抽屜：圖片列改「可滑動 Snap」；dots 用現有三顆【修改】 -->
<div class="bottom-sheet-new" id="breath-edit" data-sheet-h="657">
  <div class="">
    <button type="button" class="btn-close" id="breath-edit-Close" aria-label="Close"></button>
  </div>
  
    <h6 class="fs-9 text-primary-700 text-center mb-4">設定呼吸練習目標</h6>
    <div class="gallery-row gap-2">
      <img src="/Mofu-Diary/assets/breathnoise-D8l_2_oy.png" alt="呼吸圖片1" class="slide">
      <img src="/Mofu-Diary/assets/breathCard-tcyKfBJ5.png" alt="呼吸圖片2" class="slide">
      <img src="/Mofu-Diary/assets/breathnoise-D8l_2_oy.png" alt="呼吸圖片3" class="slide">
    </div>
    <!-- dots：會自動切換粗細 -->
    <div class="dots d-flex justify-content-center align-items-center mb-2 mt-2">
      <span class="dot" data-dot="0"></span>
      <span class="dot" data-dot="1"></span>
      <span class="dot" data-dot="2"></span>
    </div>
  <div class="px-4">
    <!-- 會跟著切換的資訊【保持結構，只更新文字】 -->
    <div class="d-flex flex-column justify-content-center align-items-center">
      <h5 id="breath-title" class="fw-bold text-primary-700 fs-9 mb-3">平衡呼吸法</h5>
      <span id="breath-ratio" class="text-primary-700 fs-12 border border-neutral-100 rounded-m px-2 py-1 mb-3">呼吸頻率 1:1</span>
      <p id="breath-sub1" class="text-primary-700 fs-12 m-0">日常練習適用</p>
      <p id="breath-sub2" class="text-primary-700 fs-12">平衡自律神經與預防壓力</p>
    </div>
    <!-- 3) 每日練習時長：刻度可拖曳/點擊，數字即時變【修改：加 id】 -->
    <div class="text-center py-3 px-2 shadow-sm mb-4 rounded-3">
      <p class="d-flex align-items-center justify-content-center">
        <span class="fw-medium fs-12  text-primary-700">練習時長</span>
        <span id="minuteVal" class="highlight fw-10 text-primary-700 fw-bold px-6px">3</span>
        <span  class="fw-medium fs-12  text-primary-700">分鐘</span>
      </p>
      <div id="ticks" class="ticks d-flex justify-content-center align-items-center">
        <!-- 9 段刻度（1~9 分）-->
        <span class="tick" data-min="1"></span>
        <span class="tick" data-min="2"></span>
        <span class="tick" data-min="3"></span>
        <span class="tick" data-min="4"></span>
        <span class="tick" data-min="5"></span>
        <span class="tick" data-min="6"></span>
        <span class="tick" data-min="7"></span>
        <span class="tick" data-min="8"></span>
        <span class="tick" data-min="9"></span>
      </div>
    </div>
    <!-- 4) 每週練習頻率：支援多選 / 每天 互斥【修改：加 data 屬性】 -->
    <div class="py-3 px-2 shadow-sm text-center rounded-3">
      <div class="row justify-content-center">
        <p class="fw-medium fs-12 text-primary-700 mb-3">
          每週練習頻率
        </p>
        <div id="weekPicker" class="col-8 d-flex flex-wrap justify-content-center gap-1">
          <button type="button" class="fs-12 py-2 px-3 btn week-btn text-primary-700 border-primary-700 border border-1 rounded-pill" data-bs-toggle="button" data-day="一">週<span>一</span></button>
          <button type="button" class="fs-12 py-2 px-3 btn week-btn text-primary-700 border-primary-700 border border-1 rounded-pill" data-bs-toggle="button" data-day="二" >週<span>二</span></button>
          <button type="button" class="fs-12 py-2 px-3 btn week-btn text-primary-700 border-primary-700 border border-1 rounded-pill" data-bs-toggle="button" data-day="三" >週<span>三</span></button>
          <button type="button" class="fs-12 py-2 px-3 btn week-btn text-primary-700 border-primary-700 border border-1 rounded-pill" data-bs-toggle="button" data-day="四" >週<span>四</span></button>
          <button type="button" class="fs-12 py-2 px-3 btn week-btn text-primary-700 border-primary-700 border border-1 rounded-pill" data-bs-toggle="button" data-day="五" >週<span>五</span></button>
          <button type="button" class="fs-12 py-2 px-3 btn week-btn text-primary-700 border-primary-700 border border-1 rounded-pill" data-bs-toggle="button" data-day="六" >週<span>六</span></button>
          <button type="button" class="fs-12 py-2 px-3 btn week-btn text-primary-700 border-primary-700 border border-1 rounded-pill" data-bs-toggle="button" data-day="日" >週<span>日</span></button>
          <button type="button" class="fs-12 py-2 px-3 btn week-btn text-primary-700 border-primary-700 border border-1 rounded-pill" data-bs-toggle="button" data-everyday="true"><span>每天</span></button>
        </div>  
      </div>
    </div>
  </div>
  <div class="sheet-footer text-center">
      <a href=""
      id="breath-save"
      class="text-decoration-none border border-primary-700 text-primary-700 fs-11 fw-medium d-block w-100 btn-py-13-5 rounded-pill">
      完成</a>
  </div>
</div>

<script>
(() => {
  // === 抽屜 ===
  const triggers = document.querySelectorAll('.js-breath-edit-trigger, #breath-edit-Btn');
  const sheet    = document.getElementById('breath-edit');
  const btnX     = document.getElementById('breath-edit-Close');
  const saveBtn  = document.getElementById('breath-save');
  if(!sheet) return;

  let backdrop = null;
  function ensureMounted(){
    if(sheet.parentElement !== document.body) document.body.appendChild(sheet);
    if(!backdrop){
      backdrop = document.createElement('div');
      backdrop.className = 'sheet-backdrop';
      backdrop.addEventListener('click', closeSheet, {passive:true});
      document.body.appendChild(backdrop);
    }
  }
  function setHeight(){
    const want = parseInt(sheet.dataset.sheetH || '657', 10);
    const vh = window.innerHeight, gap = 8;
    sheet.style.setProperty('--sheet-h', Math.min(want, vh - gap) + 'px');
  }
  function openSheet(e){
    e?.preventDefault?.();
    ensureMounted();
    setHeight();
    sheet.style.display = '';
    requestAnimationFrame(() => {
      backdrop.classList.add('show');
      sheet.classList.add('is-open');
      sheet.setAttribute('aria-hidden','false');
      document.body.classList.add('no-scroll');
      // 開啟時把滑動圖列定位到目前 index
      snapTo(activeIndex, true);
    });
  }
  function closeSheet(){
    sheet.classList.remove('is-open');
    sheet.setAttribute('aria-hidden','true');
    backdrop && backdrop.classList.remove('show');
    document.body.classList.remove('no-scroll');
  }
  sheet.addEventListener('transitionend', (e) => {
    if(e.propertyName === 'bottom' && !sheet.classList.contains('is-open')){
      sheet.style.display = 'none';
    }
  });
  triggers.forEach(el => el.addEventListener('click', openSheet, {passive:false}));
  btnX && btnX.addEventListener('click', closeSheet, {passive:true});
  window.addEventListener('keydown', (e) => {
    if(e.key === 'Escape' && sheet.classList.contains('is-open')) closeSheet();
  }, {passive:true});
  const remeasure = () => sheet.classList.contains('is-open') && setHeight();
  window.addEventListener('resize', remeasure, {passive:true});
  window.addEventListener('orientationchange', () => setTimeout(remeasure, 50), {passive:true});

  // === 滑動圖片（scroll-snap） + dots + 文案同步 ===
  const row   = sheet.querySelector('.gallery-row');
  const slides= Array.from(row.querySelectorAll('.slide'));
  const dots  = Array.from(sheet.querySelectorAll('.dot'));
  const title = sheet.querySelector('#breath-title');
  const ratio = sheet.querySelector('#breath-ratio');
  const sub1  = sheet.querySelector('#breath-sub1');
  const sub2  = sheet.querySelector('#breath-sub2');

  // 三個版本文案（除標題外其它沿用）
  const meta = [
    { title: '平衡呼吸法',  ratio: '呼吸頻率 1:1', sub1: '日常練習適用', sub2: '平衡自律神經與預防壓力' },
    { title: '平衡呼吸法2', ratio: '呼吸頻率 1:1', sub1: '日常練習適用', sub2: '平衡自律神經與預防壓力' },
    { title: '平衡呼吸法3', ratio: '呼吸頻率 1:1', sub1: '日常練習適用', sub2: '平衡自律神經與預防壓力' }
  ];

  let activeIndex = 0; // 0~2
  function applyMeta(i){
    const m = meta[i] || meta[0];
    title.textContent = m.title;
    ratio.textContent = m.ratio;
    sub1.textContent  = m.sub1;
    sub2.textContent  = m.sub2;
    dots.forEach((d,idx)=>d.classList.toggle('is-active', idx===i));
  }

  // 讓指定索引置中（考慮 slide 寬與容器寬）
  function snapTo(i, instant=false){
    const el = slides[i];
    if(!el) return;
    const left = el.offsetLeft - (row.clientWidth - el.clientWidth)/2;
    row.scrollTo({ left, behavior: instant ? 'auto' : 'smooth' });
  }

  // 依「離容器視窗中心最近」計算目前索引
function getNearestIndex(){
  const viewportCenter = row.scrollLeft + row.clientWidth/2;
  let nearest = 0, best = Infinity;
  slides.forEach((el, idx) => {
    const elCenter = el.offsetLeft + el.clientWidth/2;
    const d = Math.abs(elCenter - viewportCenter);
    if(d < best){ best = d; nearest = idx; }
  });
  return nearest;
}

// scroll 時更新 activeIndex + dots + 文案
let ticking = false;
row.addEventListener('scroll', () => {
  if(ticking) return; ticking = true;
  requestAnimationFrame(()=>{
    const i = getNearestIndex();
    if(i !== activeIndex){
      activeIndex = i;
      applyMeta(activeIndex);
    }
    ticking = false;
  });
}, {passive:true});

// 拖曳橫向滾動
let isDrag = false, startX = 0, startLeft = 0;
row.addEventListener('pointerdown', (e)=>{
  isDrag = true;
  row.classList.add('dragging');
  row.setPointerCapture(e.pointerId);
  startX = e.clientX;
  startLeft = row.scrollLeft;
});
row.addEventListener('pointermove', (e)=>{
  if(!isDrag) return;
  const dx = e.clientX - startX;
  row.scrollLeft = startLeft - dx;
});
const endDrag = (e)=>{
  if(!isDrag) return;
  isDrag = false;
  row.classList.remove('dragging');
  row.releasePointerCapture?.(e.pointerId);
  // 放開後自動貼最近一張
  activeIndex = getNearestIndex();
  snapTo(activeIndex);
  applyMeta(activeIndex);
};
row.addEventListener('pointerup', endDrag);
row.addEventListener('pointercancel', endDrag);

  // === 刻度（1~9 分）點擊/拖曳 改數值 + 視覺流動 ===
  const ticksWrap = document.getElementById('ticks');
  const ticks     = Array.from(ticksWrap.querySelectorAll('.tick'));
  const minuteEl  = document.getElementById('minuteVal');
  let minute = 3;

  function setMinute(m, animate=true){
    minute = Math.max(1, Math.min(9, m|0));
    minuteEl.textContent = String(minute);
    ticks.forEach(t => t.classList.toggle('active', Number(t.dataset.min) === minute));
    if(!animate) ticksWrap.classList.add('scrubbing'); else ticksWrap.classList.remove('scrubbing');
  }
  setMinute(minute, false);
  ticksWrap.addEventListener('click', (e)=>{
    const t = e.target.closest('.tick'); if(!t) return;
    setMinute(Number(t.dataset.min));
  });
  // 拖曳
  let dragging=false;
  const onMove = (clientX) => {
    const rect = ticksWrap.getBoundingClientRect();
    const ratio = Math.min(1, Math.max(0, (clientX - rect.left) / rect.width));
    const m = 1 + Math.round(ratio * 8);
    setMinute(m, false);
  };
  ticksWrap.addEventListener('pointerdown', (e)=>{
    dragging=true; ticksWrap.setPointerCapture(e.pointerId); ticksWrap.classList.add('scrubbing'); onMove(e.clientX);
  });
  ticksWrap.addEventListener('pointermove', (e)=> dragging && onMove(e.clientX));
  ticksWrap.addEventListener('pointerup',   (e)=>{ dragging=false; ticksWrap.releasePointerCapture(e.pointerId); ticksWrap.classList.remove('scrubbing'); });
  ticksWrap.addEventListener('pointercancel', ()=>{ dragging=false; ticksWrap.classList.remove('scrubbing'); });

  // === 每週頻率：多選；「每天」與單日互斥 ===
  const weekPicker = document.getElementById('weekPicker');
  function getDaysLabel(){
    const dayBtns = Array.from(weekPicker.querySelectorAll('[data-day].active'));
    const every   = weekPicker.querySelector('[data-everyday="true"]').classList.contains('active');
    if(every || dayBtns.length===7) return '每天';
    const text = dayBtns.map(b => b.dataset.day).join('');
    return text ? ('週' + text) : '每天';
  }
  // 互斥規則
  weekPicker.addEventListener('click', (e)=>{
    const btn = e.target.closest('.week-btn'); if(!btn) return;
    const isEvery = btn.hasAttribute('data-everyday');
    if(isEvery){
      // 按「每天」→ 取消其他日
      Array.from(weekPicker.querySelectorAll('[data-day].active')).forEach(b=>b.classList.remove('active'));
    }else{
      // 按單日 → 取消「每天」
      weekPicker.querySelector('[data-everyday="true"]')?.classList.remove('active');
    }
  });

  // === 完成：生成新的呼吸練習卡片（插在「新增呼吸練習」卡片之前） ===
  function buildDaysMiniLabel(){
    const lbl = getDaysLabel();
    if(lbl==='每天') return lbl;
    // e.g. 週一二三 → 顯示「週一二」…（你可依需求簡化/展開）
    return lbl;
  }
  function createCardHTML(titleText, daysText, minutes){
    return `
<div class="d-flex justify-content-between btn border-1 border-neutral-100 bg-neutral-0 p-3 rounded-3 w-100 mb-2">
  <div class="d-flex justify-content-between align-items-center text-primary-700">
    <svg 
    width="48" height="49" 
    viewBox="0 0 48 49" 
    fill="none" xmlns="http://www.w3.org/2000/svg"><!--fill stroke 改 currentColor 才能在scss裡改色-->
    <mask id="path-1-outside-1_2658_32976" maskUnits="userSpaceOnUse" x="7" y="8.13818" width="34" height="32" fill="black">
    <rect fill="white" x="7" y="8.13818" width="34" height="32"/>
    <path d="M38.7302 21.582C39.3445 19.0314 39.5106 16.3276 39.2153 13.751C38.8884 10.894 38.0132 9.34857 36.6133 9.16156C36.4921 9.14598 36.3655 9.13818 36.2337 9.13818C34.5149 9.13818 32.3558 10.5329 30.8479 11.7017C30.1862 12.216 29.5061 12.8835 28.905 13.4705L28.8101 13.5614C27.1756 13.0965 25.4937 12.8601 23.8092 12.8601C23.2503 12.8601 22.6861 12.8861 22.1352 12.9407C21.165 13.0316 20.1606 13.2186 19.1457 13.4991C18.5947 12.9666 17.8856 12.3043 17.1132 11.7043C15.6105 10.5329 13.4541 9.13818 11.73 9.13818C11.6008 9.13818 11.4716 9.14598 11.3504 9.16156C9.24928 9.44467 8.8723 12.6861 8.74839 13.751C8.45314 16.325 8.62186 19.0392 9.23873 21.6053C8.21588 23.7637 7.81517 26.1013 8.07879 28.3714C8.43205 31.4102 9.96633 34.2076 12.3969 36.249C15.1281 38.5451 19.3539 39.8619 23.9911 39.8619C29.1976 39.8619 33.9165 38.1659 36.6133 35.327C40.1907 31.5635 40.9974 26.3065 38.7302 21.582ZM33.7029 35.6854C31.3119 37.3243 27.7793 38.2646 24.0148 38.2646C20.4427 38.2646 17.042 37.41 14.6852 35.9192C12.5446 34.566 10.9127 32.5608 10.1746 30.3869C11.2554 30.0103 12.4048 29.8674 13.4962 29.7557L13.5358 29.7505L13.5727 29.735C13.9049 29.5947 14.0999 29.2648 14.0551 28.9142C14.0103 28.561 13.7467 28.296 13.3802 28.2389C13.2906 28.2259 13.1878 28.2181 13.0586 28.2181C12.7845 28.2181 12.4602 28.2493 12.2256 28.2727L12.1439 28.2805C11.3187 28.3636 10.5173 28.548 9.75807 28.8311C9.6368 28.2103 9.62099 27.5818 9.63417 27.0909H9.64998C9.77389 27.0909 9.90043 27.0909 10.0243 27.0857C10.1456 27.0857 10.2669 27.0805 10.3881 27.0805C10.4936 27.0805 10.5964 27.0805 10.7018 27.0883C11.0366 27.1039 11.3925 27.1662 11.7352 27.2259C12.0595 27.2831 12.3943 27.3402 12.7186 27.361C12.7713 27.3636 12.824 27.3662 12.8741 27.3662C13.1983 27.3662 13.4277 27.2857 13.5753 27.1169C13.7098 26.961 13.7599 26.7506 13.7177 26.4909C13.6307 25.9039 12.8214 25.7662 12.3389 25.6831L12.2071 25.6598C11.44 25.5169 10.6755 25.4779 9.9347 25.439C9.86616 25.4364 9.80025 25.4312 9.73171 25.4286C9.92679 24.291 10.2906 23.1637 10.8126 22.0703C11.1263 22.0962 11.4426 22.1092 11.7537 22.1092C16.3671 22.1092 20.3267 19.408 21.6026 15.3847C21.6237 15.3224 21.6554 15.1873 21.6896 15.0367C21.7186 14.9146 21.7661 14.712 21.7977 14.5978C22.0297 14.5484 22.6334 14.4809 22.8311 14.4679C23.1027 14.4523 23.3821 14.4445 23.6642 14.4445C25.9788 14.4445 28.4147 14.9354 30.3497 15.7899C34.6177 17.6782 37.6204 21.3586 38.2531 25.4494C38.203 25.4494 38.1529 25.4494 38.1028 25.4494C37.3383 25.4494 36.6397 25.5039 35.9701 25.613C34.7522 25.8156 34.5571 25.9896 34.4833 26.0546C34.2539 26.2649 34.1827 26.5974 34.3014 26.9039C34.4174 27.1974 34.6783 27.3818 34.9842 27.3818H35.0079L35.0316 27.3766C36.1652 27.1688 37.1617 27.0701 38.0738 27.0701C38.1766 27.0701 38.2794 27.0701 38.3823 27.0753C38.3796 27.5948 38.3533 28.2103 38.2557 28.8311C37.6731 28.6259 37.0457 28.4337 36.3603 28.3324C36.1151 28.296 35.4929 28.2077 35 28.2077C34.8154 28.2077 34.6678 28.2181 34.5465 28.2441C34.2012 28.3142 33.956 28.6025 33.9376 28.961C33.9191 29.322 34.1326 29.6337 34.4727 29.7428L34.4965 29.7505L34.7495 29.7791C35.63 29.8778 36.5395 29.9817 37.3805 30.2466C37.4728 30.2778 37.6678 30.3479 37.8128 30.4051C37.0615 32.5063 35.6089 34.3738 33.7029 35.6802V35.6854ZM16.4699 14.525C16.4699 14.525 16.4541 14.5043 16.4435 14.4965C15.6764 13.7147 14.7485 13.0394 13.9602 12.6887C13.4251 12.4524 12.9927 12.3355 12.6342 12.3355C11.5059 12.3355 11.2475 13.4679 11.0946 14.5302C10.9075 15.8367 10.8996 17.2366 11.0735 18.6963C10.8547 19.0028 10.6597 19.2729 10.4725 19.5171C10.4593 19.4262 10.4435 19.3353 10.4303 19.2444C10.3987 19.0392 10.367 18.8444 10.3459 18.647C10.1693 16.9302 10.222 15.0185 10.4883 13.2653C10.8231 11.1122 11.3609 10.7771 11.5744 10.7355C11.6324 10.7251 11.6957 10.7174 11.7642 10.7174C12.4444 10.7174 13.4462 11.2784 13.8732 11.5199C14.9831 12.1381 16.0956 12.9692 17.353 14.1173L16.4646 14.525H16.4699ZM37.6177 18.647C37.5967 18.8418 37.5677 19.034 37.536 19.2288C37.5228 19.3119 37.5097 19.3976 37.4965 19.4833C37.4543 19.4262 37.4121 19.3664 37.3699 19.3067C37.2645 19.1742 37.1564 19.0444 37.0615 18.9327L36.8928 18.6963C37.0668 17.234 37.0589 15.8341 36.8691 14.5302C36.7162 13.4679 36.4578 12.3355 35.3295 12.3355C34.971 12.3355 34.5386 12.4498 34.0035 12.6887C33.2179 13.0394 32.2899 13.7147 31.5254 14.4913C31.5149 14.5017 31.5043 14.512 31.4964 14.525L30.608 14.1173C31.8655 12.9692 32.978 12.1407 34.0852 11.5199C34.5518 11.2602 35.5219 10.7174 36.1968 10.7174C36.2654 10.7174 36.3313 10.7226 36.3893 10.7355C36.8401 10.8264 37.246 11.7719 37.4728 13.2653C37.7416 15.0159 37.7944 16.9276 37.6177 18.647ZM32.5957 26.8156C32.7697 27.1272 32.7249 27.5454 32.6247 27.8363C32.2161 29.0103 31.0562 29.7661 29.6695 29.7661C28.2829 29.7661 27.0939 29.0155 26.6563 27.8545C26.5429 27.5558 26.4823 27.1246 26.6537 26.813C26.7538 26.6286 26.9199 26.5065 27.1361 26.4571C27.2231 26.4364 27.3075 26.4286 27.3839 26.4286C27.9243 26.4286 28.0957 26.8831 28.2222 27.2156C28.2855 27.3818 28.3488 27.5532 28.4463 27.6675C28.7284 27.9999 29.1554 28.1896 29.6221 28.1896C30.1915 28.1896 30.6924 27.9168 30.9586 27.4623C31.0034 27.3844 31.0404 27.2831 31.0799 27.174C31.188 26.8779 31.3514 26.4286 31.876 26.4286C31.9499 26.4286 32.0289 26.439 32.1107 26.4571C32.3242 26.5065 32.4929 26.6286 32.5957 26.813V26.8156ZM21.5183 26.9272C21.7134 27.4727 21.2705 28.2571 21.0253 28.5506C20.3715 29.3376 19.4199 29.7895 18.4181 29.7895C17.3346 29.7895 16.3618 29.27 15.7529 28.3662C15.5314 28.0389 15.2599 27.3454 15.4655 26.8753C15.5367 26.7169 15.6896 26.5143 16.0297 26.4571C16.1035 26.4442 16.1747 26.439 16.2379 26.439C16.7994 26.439 16.9365 26.8753 17.0262 27.1662C17.0578 27.2649 17.0868 27.3558 17.1237 27.4337C17.3636 27.8987 17.8856 28.187 18.4866 28.187C19.0877 28.187 19.5569 27.9246 19.7995 27.4883C19.8416 27.413 19.8759 27.3117 19.9128 27.2026C20.0156 26.8987 20.1685 26.4364 20.7169 26.4364C20.7854 26.4364 20.8592 26.4442 20.9357 26.4597C21.3048 26.5351 21.455 26.7558 21.5183 26.9298V26.9272ZM25.4568 33.8569C25.4568 34.8751 24.803 35.6984 23.999 35.6984C23.1949 35.6984 22.5411 34.8751 22.5411 33.8569C22.5411 32.8388 23.1949 32.0154 23.999 32.0154C24.803 32.0154 25.4568 32.8388 25.4568 33.8569Z"/>
    <path d="M22.7995 30.3673C22.2248 29.8031 22.0798 28.6567 23.0394 28.4108C23.5508 28.2814 25.0192 28.2685 25.4568 28.5506C26.1528 28.9957 25.7995 30.0619 25.2486 30.4786C25.0614 30.6183 24.6633 30.8279 24.6633 30.8279C23.8399 30.9781 23.4612 30.7684 23.4612 30.7684C23.4612 30.7684 22.9761 30.5381 22.8021 30.3673H22.7995Z"/>
    </mask>
    <path d="M38.7302 21.582C39.3445 19.0314 39.5106 16.3276 39.2153 13.751C38.8884 10.894 38.0132 9.34857 36.6133 9.16156C36.4921 9.14598 36.3655 9.13818 36.2337 9.13818C34.5149 9.13818 32.3558 10.5329 30.8479 11.7017C30.1862 12.216 29.5061 12.8835 28.905 13.4705L28.8101 13.5614C27.1756 13.0965 25.4937 12.8601 23.8092 12.8601C23.2503 12.8601 22.6861 12.8861 22.1352 12.9407C21.165 13.0316 20.1606 13.2186 19.1457 13.4991C18.5947 12.9666 17.8856 12.3043 17.1132 11.7043C15.6105 10.5329 13.4541 9.13818 11.73 9.13818C11.6008 9.13818 11.4716 9.14598 11.3504 9.16156C9.24928 9.44467 8.8723 12.6861 8.74839 13.751C8.45314 16.325 8.62186 19.0392 9.23873 21.6053C8.21588 23.7637 7.81517 26.1013 8.07879 28.3714C8.43205 31.4102 9.96633 34.2076 12.3969 36.249C15.1281 38.5451 19.3539 39.8619 23.9911 39.8619C29.1976 39.8619 33.9165 38.1659 36.6133 35.327C40.1907 31.5635 40.9974 26.3065 38.7302 21.582ZM33.7029 35.6854C31.3119 37.3243 27.7793 38.2646 24.0148 38.2646C20.4427 38.2646 17.042 37.41 14.6852 35.9192C12.5446 34.566 10.9127 32.5608 10.1746 30.3869C11.2554 30.0103 12.4048 29.8674 13.4962 29.7557L13.5358 29.7505L13.5727 29.735C13.9049 29.5947 14.0999 29.2648 14.0551 28.9142C14.0103 28.561 13.7467 28.296 13.3802 28.2389C13.2906 28.2259 13.1878 28.2181 13.0586 28.2181C12.7845 28.2181 12.4602 28.2493 12.2256 28.2727L12.1439 28.2805C11.3187 28.3636 10.5173 28.548 9.75807 28.8311C9.6368 28.2103 9.62099 27.5818 9.63417 27.0909H9.64998C9.77389 27.0909 9.90043 27.0909 10.0243 27.0857C10.1456 27.0857 10.2669 27.0805 10.3881 27.0805C10.4936 27.0805 10.5964 27.0805 10.7018 27.0883C11.0366 27.1039 11.3925 27.1662 11.7352 27.2259C12.0595 27.2831 12.3943 27.3402 12.7186 27.361C12.7713 27.3636 12.824 27.3662 12.8741 27.3662C13.1983 27.3662 13.4277 27.2857 13.5753 27.1169C13.7098 26.961 13.7599 26.7506 13.7177 26.4909C13.6307 25.9039 12.8214 25.7662 12.3389 25.6831L12.2071 25.6598C11.44 25.5169 10.6755 25.4779 9.9347 25.439C9.86616 25.4364 9.80025 25.4312 9.73171 25.4286C9.92679 24.291 10.2906 23.1637 10.8126 22.0703C11.1263 22.0962 11.4426 22.1092 11.7537 22.1092C16.3671 22.1092 20.3267 19.408 21.6026 15.3847C21.6237 15.3224 21.6554 15.1873 21.6896 15.0367C21.7186 14.9146 21.7661 14.712 21.7977 14.5978C22.0297 14.5484 22.6334 14.4809 22.8311 14.4679C23.1027 14.4523 23.3821 14.4445 23.6642 14.4445C25.9788 14.4445 28.4147 14.9354 30.3497 15.7899C34.6177 17.6782 37.6204 21.3586 38.2531 25.4494C38.203 25.4494 38.1529 25.4494 38.1028 25.4494C37.3383 25.4494 36.6397 25.5039 35.9701 25.613C34.7522 25.8156 34.5571 25.9896 34.4833 26.0546C34.2539 26.2649 34.1827 26.5974 34.3014 26.9039C34.4174 27.1974 34.6783 27.3818 34.9842 27.3818H35.0079L35.0316 27.3766C36.1652 27.1688 37.1617 27.0701 38.0738 27.0701C38.1766 27.0701 38.2794 27.0701 38.3823 27.0753C38.3796 27.5948 38.3533 28.2103 38.2557 28.8311C37.6731 28.6259 37.0457 28.4337 36.3603 28.3324C36.1151 28.296 35.4929 28.2077 35 28.2077C34.8154 28.2077 34.6678 28.2181 34.5465 28.2441C34.2012 28.3142 33.956 28.6025 33.9376 28.961C33.9191 29.322 34.1326 29.6337 34.4727 29.7428L34.4965 29.7505L34.7495 29.7791C35.63 29.8778 36.5395 29.9817 37.3805 30.2466C37.4728 30.2778 37.6678 30.3479 37.8128 30.4051C37.0615 32.5063 35.6089 34.3738 33.7029 35.6802V35.6854ZM16.4699 14.525C16.4699 14.525 16.4541 14.5043 16.4435 14.4965C15.6764 13.7147 14.7485 13.0394 13.9602 12.6887C13.4251 12.4524 12.9927 12.3355 12.6342 12.3355C11.5059 12.3355 11.2475 13.4679 11.0946 14.5302C10.9075 15.8367 10.8996 17.2366 11.0735 18.6963C10.8547 19.0028 10.6597 19.2729 10.4725 19.5171C10.4593 19.4262 10.4435 19.3353 10.4303 19.2444C10.3987 19.0392 10.367 18.8444 10.3459 18.647C10.1693 16.9302 10.222 15.0185 10.4883 13.2653C10.8231 11.1122 11.3609 10.7771 11.5744 10.7355C11.6324 10.7251 11.6957 10.7174 11.7642 10.7174C12.4444 10.7174 13.4462 11.2784 13.8732 11.5199C14.9831 12.1381 16.0956 12.9692 17.353 14.1173L16.4646 14.525H16.4699ZM37.6177 18.647C37.5967 18.8418 37.5677 19.034 37.536 19.2288C37.5228 19.3119 37.5097 19.3976 37.4965 19.4833C37.4543 19.4262 37.4121 19.3664 37.3699 19.3067C37.2645 19.1742 37.1564 19.0444 37.0615 18.9327L36.8928 18.6963C37.0668 17.234 37.0589 15.8341 36.8691 14.5302C36.7162 13.4679 36.4578 12.3355 35.3295 12.3355C34.971 12.3355 34.5386 12.4498 34.0035 12.6887C33.2179 13.0394 32.2899 13.7147 31.5254 14.4913C31.5149 14.5017 31.5043 14.512 31.4964 14.525L30.608 14.1173C31.8655 12.9692 32.978 12.1407 34.0852 11.5199C34.5518 11.2602 35.5219 10.7174 36.1968 10.7174C36.2654 10.7174 36.3313 10.7226 36.3893 10.7355C36.8401 10.8264 37.246 11.7719 37.4728 13.2653C37.7416 15.0159 37.7944 16.9276 37.6177 18.647ZM32.5957 26.8156C32.7697 27.1272 32.7249 27.5454 32.6247 27.8363C32.2161 29.0103 31.0562 29.7661 29.6695 29.7661C28.2829 29.7661 27.0939 29.0155 26.6563 27.8545C26.5429 27.5558 26.4823 27.1246 26.6537 26.813C26.7538 26.6286 26.9199 26.5065 27.1361 26.4571C27.2231 26.4364 27.3075 26.4286 27.3839 26.4286C27.9243 26.4286 28.0957 26.8831 28.2222 27.2156C28.2855 27.3818 28.3488 27.5532 28.4463 27.6675C28.7284 27.9999 29.1554 28.1896 29.6221 28.1896C30.1915 28.1896 30.6924 27.9168 30.9586 27.4623C31.0034 27.3844 31.0404 27.2831 31.0799 27.174C31.188 26.8779 31.3514 26.4286 31.876 26.4286C31.9499 26.4286 32.0289 26.439 32.1107 26.4571C32.3242 26.5065 32.4929 26.6286 32.5957 26.813V26.8156ZM21.5183 26.9272C21.7134 27.4727 21.2705 28.2571 21.0253 28.5506C20.3715 29.3376 19.4199 29.7895 18.4181 29.7895C17.3346 29.7895 16.3618 29.27 15.7529 28.3662C15.5314 28.0389 15.2599 27.3454 15.4655 26.8753C15.5367 26.7169 15.6896 26.5143 16.0297 26.4571C16.1035 26.4442 16.1747 26.439 16.2379 26.439C16.7994 26.439 16.9365 26.8753 17.0262 27.1662C17.0578 27.2649 17.0868 27.3558 17.1237 27.4337C17.3636 27.8987 17.8856 28.187 18.4866 28.187C19.0877 28.187 19.5569 27.9246 19.7995 27.4883C19.8416 27.413 19.8759 27.3117 19.9128 27.2026C20.0156 26.8987 20.1685 26.4364 20.7169 26.4364C20.7854 26.4364 20.8592 26.4442 20.9357 26.4597C21.3048 26.5351 21.455 26.7558 21.5183 26.9298V26.9272ZM25.4568 33.8569C25.4568 34.8751 24.803 35.6984 23.999 35.6984C23.1949 35.6984 22.5411 34.8751 22.5411 33.8569C22.5411 32.8388 23.1949 32.0154 23.999 32.0154C24.803 32.0154 25.4568 32.8388 25.4568 33.8569Z" fill="currentColor"/>
    <path d="M22.7995 30.3673C22.2248 29.8031 22.0798 28.6567 23.0394 28.4108C23.5508 28.2814 25.0192 28.2685 25.4568 28.5506C26.1528 28.9957 25.7995 30.0619 25.2486 30.4786C25.0614 30.6183 24.6633 30.8279 24.6633 30.8279C23.8399 30.9781 23.4612 30.7684 23.4612 30.7684C23.4612 30.7684 22.9761 30.5381 22.8021 30.3673H22.7995Z" fill="currentColor"/>
    <path d="M38.7302 21.582C39.3445 19.0314 39.5106 16.3276 39.2153 13.751C38.8884 10.894 38.0132 9.34857 36.6133 9.16156C36.4921 9.14598 36.3655 9.13818 36.2337 9.13818C34.5149 9.13818 32.3558 10.5329 30.8479 11.7017C30.1862 12.216 29.5061 12.8835 28.905 13.4705L28.8101 13.5614C27.1756 13.0965 25.4937 12.8601 23.8092 12.8601C23.2503 12.8601 22.6861 12.8861 22.1352 12.9407C21.165 13.0316 20.1606 13.2186 19.1457 13.4991C18.5947 12.9666 17.8856 12.3043 17.1132 11.7043C15.6105 10.5329 13.4541 9.13818 11.73 9.13818C11.6008 9.13818 11.4716 9.14598 11.3504 9.16156C9.24928 9.44467 8.8723 12.6861 8.74839 13.751C8.45314 16.325 8.62186 19.0392 9.23873 21.6053C8.21588 23.7637 7.81517 26.1013 8.07879 28.3714C8.43205 31.4102 9.96633 34.2076 12.3969 36.249C15.1281 38.5451 19.3539 39.8619 23.9911 39.8619C29.1976 39.8619 33.9165 38.1659 36.6133 35.327C40.1907 31.5635 40.9974 26.3065 38.7302 21.582ZM33.7029 35.6854C31.3119 37.3243 27.7793 38.2646 24.0148 38.2646C20.4427 38.2646 17.042 37.41 14.6852 35.9192C12.5446 34.566 10.9127 32.5608 10.1746 30.3869C11.2554 30.0103 12.4048 29.8674 13.4962 29.7557L13.5358 29.7505L13.5727 29.735C13.9049 29.5947 14.0999 29.2648 14.0551 28.9142C14.0103 28.561 13.7467 28.296 13.3802 28.2389C13.2906 28.2259 13.1878 28.2181 13.0586 28.2181C12.7845 28.2181 12.4602 28.2493 12.2256 28.2727L12.1439 28.2805C11.3187 28.3636 10.5173 28.548 9.75807 28.8311C9.6368 28.2103 9.62099 27.5818 9.63417 27.0909H9.64998C9.77389 27.0909 9.90043 27.0909 10.0243 27.0857C10.1456 27.0857 10.2669 27.0805 10.3881 27.0805C10.4936 27.0805 10.5964 27.0805 10.7018 27.0883C11.0366 27.1039 11.3925 27.1662 11.7352 27.2259C12.0595 27.2831 12.3943 27.3402 12.7186 27.361C12.7713 27.3636 12.824 27.3662 12.8741 27.3662C13.1983 27.3662 13.4277 27.2857 13.5753 27.1169C13.7098 26.961 13.7599 26.7506 13.7177 26.4909C13.6307 25.9039 12.8214 25.7662 12.3389 25.6831L12.2071 25.6598C11.44 25.5169 10.6755 25.4779 9.9347 25.439C9.86616 25.4364 9.80025 25.4312 9.73171 25.4286C9.92679 24.291 10.2906 23.1637 10.8126 22.0703C11.1263 22.0962 11.4426 22.1092 11.7537 22.1092C16.3671 22.1092 20.3267 19.408 21.6026 15.3847C21.6237 15.3224 21.6554 15.1873 21.6896 15.0367C21.7186 14.9146 21.7661 14.712 21.7977 14.5978C22.0297 14.5484 22.6334 14.4809 22.8311 14.4679C23.1027 14.4523 23.3821 14.4445 23.6642 14.4445C25.9788 14.4445 28.4147 14.9354 30.3497 15.7899C34.6177 17.6782 37.6204 21.3586 38.2531 25.4494C38.203 25.4494 38.1529 25.4494 38.1028 25.4494C37.3383 25.4494 36.6397 25.5039 35.9701 25.613C34.7522 25.8156 34.5571 25.9896 34.4833 26.0546C34.2539 26.2649 34.1827 26.5974 34.3014 26.9039C34.4174 27.1974 34.6783 27.3818 34.9842 27.3818H35.0079L35.0316 27.3766C36.1652 27.1688 37.1617 27.0701 38.0738 27.0701C38.1766 27.0701 38.2794 27.0701 38.3823 27.0753C38.3796 27.5948 38.3533 28.2103 38.2557 28.8311C37.6731 28.6259 37.0457 28.4337 36.3603 28.3324C36.1151 28.296 35.4929 28.2077 35 28.2077C34.8154 28.2077 34.6678 28.2181 34.5465 28.2441C34.2012 28.3142 33.956 28.6025 33.9376 28.961C33.9191 29.322 34.1326 29.6337 34.4727 29.7428L34.4965 29.7505L34.7495 29.7791C35.63 29.8778 36.5395 29.9817 37.3805 30.2466C37.4728 30.2778 37.6678 30.3479 37.8128 30.4051C37.0615 32.5063 35.6089 34.3738 33.7029 35.6802V35.6854ZM16.4699 14.525C16.4699 14.525 16.4541 14.5043 16.4435 14.4965C15.6764 13.7147 14.7485 13.0394 13.9602 12.6887C13.4251 12.4524 12.9927 12.3355 12.6342 12.3355C11.5059 12.3355 11.2475 13.4679 11.0946 14.5302C10.9075 15.8367 10.8996 17.2366 11.0735 18.6963C10.8547 19.0028 10.6597 19.2729 10.4725 19.5171C10.4593 19.4262 10.4435 19.3353 10.4303 19.2444C10.3987 19.0392 10.367 18.8444 10.3459 18.647C10.1693 16.9302 10.222 15.0185 10.4883 13.2653C10.8231 11.1122 11.3609 10.7771 11.5744 10.7355C11.6324 10.7251 11.6957 10.7174 11.7642 10.7174C12.4444 10.7174 13.4462 11.2784 13.8732 11.5199C14.9831 12.1381 16.0956 12.9692 17.353 14.1173L16.4646 14.525H16.4699ZM37.6177 18.647C37.5967 18.8418 37.5677 19.034 37.536 19.2288C37.5228 19.3119 37.5097 19.3976 37.4965 19.4833C37.4543 19.4262 37.4121 19.3664 37.3699 19.3067C37.2645 19.1742 37.1564 19.0444 37.0615 18.9327L36.8928 18.6963C37.0668 17.234 37.0589 15.8341 36.8691 14.5302C36.7162 13.4679 36.4578 12.3355 35.3295 12.3355C34.971 12.3355 34.5386 12.4498 34.0035 12.6887C33.2179 13.0394 32.2899 13.7147 31.5254 14.4913C31.5149 14.5017 31.5043 14.512 31.4964 14.525L30.608 14.1173C31.8655 12.9692 32.978 12.1407 34.0852 11.5199C34.5518 11.2602 35.5219 10.7174 36.1968 10.7174C36.2654 10.7174 36.3313 10.7226 36.3893 10.7355C36.8401 10.8264 37.246 11.7719 37.4728 13.2653C37.7416 15.0159 37.7944 16.9276 37.6177 18.647ZM32.5957 26.8156C32.7697 27.1272 32.7249 27.5454 32.6247 27.8363C32.2161 29.0103 31.0562 29.7661 29.6695 29.7661C28.2829 29.7661 27.0939 29.0155 26.6563 27.8545C26.5429 27.5558 26.4823 27.1246 26.6537 26.813C26.7538 26.6286 26.9199 26.5065 27.1361 26.4571C27.2231 26.4364 27.3075 26.4286 27.3839 26.4286C27.9243 26.4286 28.0957 26.8831 28.2222 27.2156C28.2855 27.3818 28.3488 27.5532 28.4463 27.6675C28.7284 27.9999 29.1554 28.1896 29.6221 28.1896C30.1915 28.1896 30.6924 27.9168 30.9586 27.4623C31.0034 27.3844 31.0404 27.2831 31.0799 27.174C31.188 26.8779 31.3514 26.4286 31.876 26.4286C31.9499 26.4286 32.0289 26.439 32.1107 26.4571C32.3242 26.5065 32.4929 26.6286 32.5957 26.813V26.8156ZM21.5183 26.9272C21.7134 27.4727 21.2705 28.2571 21.0253 28.5506C20.3715 29.3376 19.4199 29.7895 18.4181 29.7895C17.3346 29.7895 16.3618 29.27 15.7529 28.3662C15.5314 28.0389 15.2599 27.3454 15.4655 26.8753C15.5367 26.7169 15.6896 26.5143 16.0297 26.4571C16.1035 26.4442 16.1747 26.439 16.2379 26.439C16.7994 26.439 16.9365 26.8753 17.0262 27.1662C17.0578 27.2649 17.0868 27.3558 17.1237 27.4337C17.3636 27.8987 17.8856 28.187 18.4866 28.187C19.0877 28.187 19.5569 27.9246 19.7995 27.4883C19.8416 27.413 19.8759 27.3117 19.9128 27.2026C20.0156 26.8987 20.1685 26.4364 20.7169 26.4364C20.7854 26.4364 20.8592 26.4442 20.9357 26.4597C21.3048 26.5351 21.455 26.7558 21.5183 26.9298V26.9272ZM25.4568 33.8569C25.4568 34.8751 24.803 35.6984 23.999 35.6984C23.1949 35.6984 22.5411 34.8751 22.5411 33.8569C22.5411 32.8388 23.1949 32.0154 23.999 32.0154C24.803 32.0154 25.4568 32.8388 25.4568 33.8569Z" stroke="currentColor" stroke-width="0.2" mask="url(#path-1-outside-1_2658_32976)"/>
    <path d="M22.7995 30.3673C22.2248 29.8031 22.0798 28.6567 23.0394 28.4108C23.5508 28.2814 25.0192 28.2685 25.4568 28.5506C26.1528 28.9957 25.7995 30.0619 25.2486 30.4786C25.0614 30.6183 24.6633 30.8279 24.6633 30.8279C23.8399 30.9781 23.4612 30.7684 23.4612 30.7684C23.4612 30.7684 22.9761 30.5381 22.8021 30.3673H22.7995Z" stroke="currentColor" stroke-width="0.2" mask="url(#path-1-outside-1_2658_32976)"/>
    </svg>
    <h6 class="mb-0 ms-2 fs-11">${titleText}</h6>
  </div>
  <div class="d-flex align-items-center">
    <div class="d-flex flex-column align-items-end me-2">
      <p class="mb-0 fs-11 text-primary-600">${daysText}</p>
      <div class="d-flex">
        <p class="mb-0 fs-11 text-primary-700">練習</p>
        <p class="mb-0 fs-11 text-primary-600">${minutes}</p>
        <p class="mb-0 fs-11 text-primary-700">分鐘</p>
      </div>
    </div>
    <a href="javascript:void(0)" class="js-breath-edit-trigger">
      <svg class="bg-primary-50 btn border border-1 p-0 rounded-2 border-primary-200" width="36" height="36" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11.4286 36.5714H13.8514L31.7714 18.6743L29.3257 16.2286L11.4286 34.1714V36.5714ZM9.71429 40C9.2419 40 8.8381 39.8324 8.50286 39.4971C8.16762 39.1619 8 38.7581 8 38.2857V34.1458C8 33.6905 8.08747 33.253 8.2624 32.8334C8.43733 32.4134 8.6851 32.0442 9.00571 31.7257L31.7714 8.98286C32.1061 8.66956 32.4754 8.42743 32.8795 8.25646C33.2837 8.08549 33.7138 8 34.1701 8C34.6263 8 35.0682 8.08762 35.4958 8.26286C35.9234 8.4381 36.3048 8.69333 36.64 9.02857L39.0171 11.4286C39.3524 11.7486 39.6 12.1181 39.76 12.5371C39.92 12.9562 40 13.3832 40 13.8181C40 14.2822 39.9217 14.7191 39.765 15.1287C39.6084 15.5383 39.3591 15.9125 39.0171 16.2514L16.2743 38.9943C15.957 39.3149 15.5893 39.5627 15.1712 39.7376C14.7528 39.9125 14.3128 40 13.8514 40H9.71429ZM30.5371 17.4629L29.3257 16.2286L31.7714 18.6743L30.5371 17.4629Z" fill="#BC8035"/>
      </svg>
    </a>
  </div>
</div>`;
  }

  saveBtn?.addEventListener('click', (e)=>{
    e.preventDefault();
    const daysText = buildDaysMiniLabel();
    const titleText = ['平衡呼吸1','平衡呼吸2','平衡呼吸3'][activeIndex] || '平衡呼吸1';

    const newCardHTML = createCardHTML(titleText, daysText, minute);
    const wrapper = document.querySelector('[data-role="add-card"]')?.parentElement || document.body;
    const addCard = document.querySelector('[data-role="add-card"]');

    const temp = document.createElement('div');
    temp.innerHTML = newCardHTML.trim();
    const newCard = temp.firstElementChild;

    // 插在「新增呼吸練習」卡之前
    if(addCard && addCard.parentElement){
      addCard.parentElement.insertBefore(newCard, addCard);
    }else{
      wrapper.appendChild(newCard);
    }

    // 讓新卡上的編輯鈕也能開抽屜
    newCard.querySelectorAll('.js-breath-edit-trigger').forEach(el => {
      el.addEventListener('click', openSheet, {passive:false});
    });

    closeSheet();
  });
})();
</script>          </div>     
          <div class="mb-5 p-2 border border-1 border-primary-700 border-dotted rounded-3">
            <h3 class="fs-11 text-primary-600 mb-2">和 Mofu 分享我的一天...</h3>
            <!--myday-diary-template.ejs  -->
<p class="fs-12 text-primary-700 mb-0">你可以在這裡設定日記主題</p> <!--p的通用樣式可能錯了-->
<p class="fs-12 text-primary-700 mb-2">書寫可以幫助你釋放情緒與思緒 好好結束一天</p><!--p的通用樣式可能錯了-->
<div id="topicContainer" class="d-flex flex-wrap gap-3 mb-3">
  <button type="button" class="fs-12 p-3 btn topic-btn text-primary-500 border-primary-500 border border-1 rounded-1" data-bs-toggle="button">日常生活</button>
  <button type="button" class="fs-12 p-3 btn topic-btn text-primary-500 border-primary-500 border border-1 rounded-1" data-bs-toggle="button">感謝的事</button>
  <button type="button" class="fs-12 p-3 btn topic-btn text-primary-500 border-primary-500 border border-1 rounded-1" data-bs-toggle="button">今日成就</button>
  <button type="button" class="fs-12 p-3 btn topic-btn text-primary-500 border-primary-500 border border-1 rounded-1" data-bs-toggle="button">重要的事</button>
  <button type="button" class="fs-12 p-3 btn topic-btn text-primary-500 border-primary-500 border border-1 rounded-1" data-bs-toggle="button">很棒的事</button>
  <button type="button" class="fs-12 p-3 btn topic-btn text-primary-500 border-primary-500 border border-1 rounded-1" data-bs-toggle="button">其他</button>
  <button type="button" 
    class="fs-12 p-3 btn topic-btn topic-btn-custom text-primary-500 border-primary-500 border border-1 rounded-1" 
    data-bs-toggle="modal"
    data-bs-target="#topicCustomModal">
    ＋ 自訂
  </button> 
</div>
<a class="d-flex align-items-center text-primary-700" href="settingTemplate.html">
  <p class="fs-12 mb-0">前往設定</p>
  <p class="fs-12 fw-bold mb-0">筆記模板</p>
</a>

<!-- 自訂主題 Modal -->
<div class="modal fade" id="topicCustomModal" 
  tabindex="-1" aria-labelledby="topicCustomModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-neutral-0 rounded-s border-0 p-0">
      <div class="modal-body px-4 py-3">
        <h5 class="fs-11 text-primary-700 text-start" id="topicCustomModalLabel">自訂日記主題</h5>
        <div class="d-flex mb-2 bg-neutral-0">
          <input id="topicCustomInput" type="text" 
            class="form-control rounded-3 px-6 py-3 me-2" 
            maxlength="5" placeholder="最多 5 字">
          <button type="button" 
          class="btn rounded-3 btn-primary-700 text-neutral-0 py-3 px-5 text-nowrap" 
          id="topicCustomConfirm" disabled>確認</button>
        </div>
        <div class="form-text text-neutral-400 text-start">上限
          <span id="topicCustomCount">0</span>/ 5字
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // 允許沒有 topicContainer 時仍能新增卡片
  const container = document.getElementById('topicContainer');

  const modalEl   = document.getElementById('topicCustomModal');
  const inputEl   = document.getElementById('topicCustomInput');
  const countEl   = document.getElementById('topicCustomCount');
  const confirmEl = document.getElementById('topicCustomConfirm');
  if (!modalEl || !inputEl || !countEl || !confirmEl) return;

  // Modal 掛到 body，避免抽屜層級影響
  if (modalEl.parentElement !== document.body) document.body.appendChild(modalEl);

  const bsModal = window.bootstrap?.Modal.getOrCreateInstance(modalEl, {
    backdrop:true, keyboard:true, focus:true
  });

  // —— 新增：slugify 與建立卡片 —— //
  function slugify(s){
    return s.toLowerCase()
      .replace(/[^\p{L}\p{N}]+/gu,'-')
      .replace(/^-+|-+$/g,'')
      .slice(0,24);
  }
  function createDiaryCard(title){
    const accRoot = document.getElementById('accordionFlushExample');
    if (!accRoot) return;
    const uid = 'flush-' + slugify(title || 'custom') + '-' + Date.now().toString(36).slice(-4);

    const item = document.createElement('div');
    item.className = 'accordion-item rounded-top-m rounded-bottom-xs pb-4 pt-0 px-5';
    item.innerHTML = `
      <h2 class="accordion-header">
        <button class="accordion-button collapsed fs-11 text-primary-700 fw-medium p-0"
                type="button" data-bs-toggle="collapse"
                data-bs-target="#${uid}" aria-controls="${uid}" aria-expanded="false">
          ${title}
        </button>
      </h2>
      <div id="${uid}" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
        <div class="accordion-body p-0">
          <textarea class="form-control rounded-3 text-primary-700 diary-textarea shadow-mini"
                    data-section="daily" placeholder="請輸入文字"></textarea>
          <div class="saved-list mt-2"></div>
        </div>
      </div>`;
    // 追加到最後，讓它成為新的 :last-child → 收折時吃漸層
    accRoot.appendChild(item);
    // 通知群組控制刷新
    accRoot.dispatchEvent(new Event('accordion:updated'));
  }
  // —— 新增結束 —— //

  modalEl.addEventListener('shown.bs.modal', () => {
    inputEl.value = '';
    countEl.textContent = '0';
    confirmEl.disabled = true;
    inputEl.focus();
  });
  inputEl.addEventListener('input', () => {
    const v = inputEl.value.trim();
    countEl.textContent = v.length;
    confirmEl.disabled = (v.length === 0);
  });
  inputEl.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !confirmEl.disabled) confirmEl.click();
  });

  confirmEl.addEventListener('click', (e) => {
    e.preventDefault(); e.stopPropagation();
    const text = inputEl.value.trim();
    if (!text) return;

    // 有主題容器才新增按鈕；沒有就略過，不中止流程
    if (container) {
      const anchor = container.querySelector('.topic-btn-custom')
                || container.querySelector('[data-bs-target="#topicCustomModal"]');
      const exists = Array.from(container.querySelectorAll('.topic-btn, .topic-btn-custom'))
                    .some(b => b.textContent.trim() === text);
      if (!exists && anchor) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'fs-12 p-3 btn topic-btn text-primary-500 border-primary-500 border border-1 rounded-1';
        btn.setAttribute('data-bs-toggle', 'button');
        btn.textContent = text;
        container.insertBefore(btn, anchor);
      }
    }

    // ☆ 關鍵：同步在預覽區新增一張卡片（成為新的最外層）
    createDiaryCard(text);

    bsModal?.hide();
    document.getElementById('relaxPanel')?.classList.add('is-open');
    window.dispatchEvent(new Event('resize'));
  });
});
</script>          </div>
          <div class="mb-5">
            <h3 class="fs-11 text-primary-600 mb-2">預覽</h3>
            <!--myday-diary-cards.ejs  -->
<div class="accordion accordion-flush mb-2" id="accordionFlushExample">
  <div class="accordion-item rounded-top-m rounded-bottom-xs pb-4 pt-0 px-5">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed fs-11 text-primary-700 fw-medium p-0" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
        日常生活
      </button>
    </h2>
    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
      <div class="accordion-body p-0">
        <!-- ★ 改 textarea；加 data-section 與類名 -->
        <textarea
          class="form-control rounded-3 text-primary-700 diary-textarea shadow-mini"
          data-section="daily"
          placeholder="請輸入文字"></textarea>
        <!-- ★ 儲存後會把文字插在這裡 -->
        <div class="saved-list mt-2"></div>
      </div>
    </div>
  </div>
  <div class="accordion-item rounded-top-m rounded-bottom-xs pb-4 pt-0 px-5">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed fs-11 text-primary-700 fw-medium p-0" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
        感謝的事
      </button>
    </h2>
    <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
      <div class="accordion-body p-0">
        <!-- ★ 改 textarea；加 data-section 與類名 -->
        <textarea
          class="form-control rounded-3 text-primary-700 diary-textarea shadow-mini"
          data-section="daily"
          placeholder="請輸入文字"></textarea>
        <!-- ★ 儲存後會把文字插在這裡 -->
        <div class="saved-list mt-2"></div> 
      </div>
    </div>
  </div>
  <div class="accordion-item rounded-top-m rounded-bottom-xs pb-4 pt-0 px-5">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed fs-11 text-primary-700 fw-medium p-0" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
        其他
      </button>
    </h2>
    <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
      <div class="accordion-body p-0"> 
        <!-- ★ 改 textarea；加 data-section 與類名 -->
        <textarea
          class="form-control rounded-3 text-primary-700 diary-textarea shadow-mini"
          data-section="daily"
          placeholder="請輸入文字"></textarea>
        <!-- ★ 儲存後會把文字插在這裡 -->
        <div class="saved-list mt-2"></div>                 
      </div>
    </div>
  </div>
</div>


<script>
/* 動態版：新增卡片後自動納入群組展開/收合 */
(function(){
  const $  = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

  const accRoot = document.getElementById('accordionFlushExample');
  if (!accRoot) return;

  const Bootstrap = window.bootstrap;
  const instMap = new Map(); // el => Collapse instance

  function collapses(){ return $$('#accordionFlushExample .accordion-collapse'); }
  function buttons(){ return $$('#accordionFlushExample .accordion-button'); }

  function ensureInstances(){
    const els = collapses();
    if (!Bootstrap?.Collapse) return els;
    els.forEach(el => {
      if (!instMap.has(el)) {
        instMap.set(el, Bootstrap.Collapse.getOrCreateInstance(el, { toggle:false }));
      }
    });
    for (const el of [...instMap.keys()]) if (!el.isConnected) instMap.delete(el);
    return els;
  }

  const isAllShown = () => collapses().every(el => el.classList.contains('show'));

  function setAll(open){
    if (instMap.size > 0) {
      for (const inst of instMap.values()) open ? inst.show() : inst.hide();
    } else {
      collapses().forEach(el => {
        el.classList.toggle('show', open);
        el.style.height = open ? 'auto' : '';
      });
      buttons().forEach(btn => {
        btn.classList.toggle('collapsed', !open);
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    }
    accRoot.classList.toggle('acc-open', open);
  }

  function syncFlag(){ accRoot.classList.toggle('acc-open', isAllShown()); }

  ensureInstances();

  accRoot.addEventListener('click', (e) => {
    const btn = e.target.closest('.accordion-button');
    if (!btn) return;
    e.preventDefault(); e.stopPropagation();
    setAll(!isAllShown());
  });

  accRoot.addEventListener('shown.bs.collapse', syncFlag);
  accRoot.addEventListener('hidden.bs.collapse', syncFlag);

  // 新卡片進場時刷新
  const mo = new MutationObserver(() => { ensureInstances(); syncFlag(); });
  mo.observe(accRoot, { childList:true, subtree:true });

  // 接收外部通知
  accRoot.addEventListener('accordion:updated', () => { ensureInstances(); syncFlag(); });
})();
</script>            <div class="border-1 border-neutral-100 bg-primary-100 p-3 rounded-3 d-flex justify-content-center align-items-center">
              <button class="btn p-0 d-flex align-items-center">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M24 32.8206C26.0103 32.8206 27.7128 32.1232 29.1077 30.7283C30.5026 29.3334 31.2 27.6309 31.2 25.6206C31.2 23.6103 30.5026 21.9078 29.1077 20.5129C27.7128 19.118 26.0103 18.4206 24 18.4206C21.9897 18.4206 20.2872 19.118 18.8923 20.5129C17.4974 21.9078 16.8 23.6103 16.8 25.6206C16.8 27.6309 17.4974 29.3334 18.8923 30.7283C20.2872 32.1232 21.9897 32.8206 24 32.8206ZM23.9918 29.7437C22.8349 29.7437 21.8598 29.3471 21.0667 28.5539C20.2735 27.7608 19.8769 26.7857 19.8769 25.6288C19.8769 24.4722 20.2735 23.4944 21.0667 22.6955C21.8598 21.8968 22.8349 21.4975 23.9918 21.4975C25.1484 21.4975 26.1262 21.8968 26.9251 22.6955C27.7238 23.4944 28.1231 24.4722 28.1231 25.6288C28.1231 26.7857 27.7238 27.7608 26.9251 28.5539C26.1262 29.3471 25.1484 29.7437 23.9918 29.7437ZM11.0769 38.3591C10.2307 38.3591 9.50632 38.0578 8.90379 37.4553C8.30126 36.8527 8 36.1284 8 35.2821V15.9796C8 15.1334 8.30126 14.409 8.90379 13.8064C9.50632 13.2039 10.2307 12.9027 11.0769 12.9027H16.2462L18.2769 10.6668C18.5625 10.3511 18.9064 10.1013 19.3087 9.91722C19.711 9.73315 20.1329 9.64111 20.5744 9.64111H27.4256C27.8671 9.64111 28.289 9.73315 28.6913 9.91722C29.0936 10.1013 29.4375 10.3511 29.7231 10.6668L31.7538 12.9027H36.9231C37.7693 12.9027 38.4937 13.2039 39.0962 13.8064C39.6987 14.409 40 15.1334 40 15.9796V35.2821C40 36.1284 39.6987 36.8527 39.0962 37.4553C38.4937 38.0578 37.7693 38.3591 36.9231 38.3591H11.0769Z" fill="#BC8035"/>
                </svg>
                <p class="mb-0 fs-11 text-primary-700">新增照片</p>
              </button>
            </div>
            <p class="fs-11 text-primary-700 mb-0">已上傳 0 / 3 張</p>
          </div>

          <a class="btn text-neutral-0 bg-primary-500 mb-2 rounded-5" href="index.html">完成</a>
          <a class="btn text-alert-300 border-1 border-alert-300 rounded-5 mb-6" href="index.html">
              取消編輯
          </a>
        </div>
      </div><!--row-->
    </div>
    <div class="bottom-nav px-7 pt-3 pb-7 rounded-top-m shadow-lg w-100">
  <ul class="list-unstyled d-flex justify-content-between mb-0">
    <li>
      <a href="./overview.html" class="d-flex flex-column text-center text-decoration-none btn-nav-bottom">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M28.8077 39C27.9262 39 27.1717 38.6862 26.544 38.0585C25.9164 37.4309 25.6026 36.6764 25.6026 35.7949V28.8077C25.6026 27.9262 25.9164 27.1717 26.544 26.544C27.1717 25.9164 27.9262 25.6026 28.8077 25.6026H35.7949C36.6764 25.6026 37.4309 25.9164 38.0585 26.544C38.6862 27.1717 39 27.9262 39 28.8077V35.7949C39 36.6764 38.6862 37.4309 38.0585 38.0585C37.4309 38.6862 36.6764 39 35.7949 39H28.8077ZM28.8077 22.3974C27.9262 22.3974 27.1717 22.0836 26.544 21.456C25.9164 20.8283 25.6026 20.0738 25.6026 19.1923V12.2051C25.6026 11.3236 25.9164 10.5691 26.544 9.94145C27.1717 9.31382 27.9262 9 28.8077 9H35.7949C36.6764 9 37.4309 9.31382 38.0585 9.94145C38.6862 10.5691 39 11.3236 39 12.2051V19.1923C39 20.0738 38.6862 20.8283 38.0585 21.456C37.4309 22.0836 36.6764 22.3974 35.7949 22.3974H28.8077ZM12.2051 22.3974C11.3236 22.3974 10.5691 22.0836 9.94145 21.456C9.31382 20.8283 9 20.0738 9 19.1923V12.2051C9 11.3236 9.31382 10.5691 9.94145 9.94145C10.5691 9.31382 11.3236 9 12.2051 9H19.1923C20.0738 9 20.8283 9.31382 21.456 9.94145C22.0836 10.5691 22.3974 11.3236 22.3974 12.2051V19.1923C22.3974 20.0738 22.0836 20.8283 21.456 21.456C20.8283 22.0836 20.0738 22.3974 19.1923 22.3974H12.2051ZM12.2051 39C11.3236 39 10.5691 38.6862 9.94145 38.0585C9.31382 37.4309 9 36.6764 9 35.7949V28.8077C9 27.9262 9.31382 27.1717 9.94145 26.544C10.5691 25.9164 11.3236 25.6026 12.2051 25.6026H19.1923C20.0738 25.6026 20.8283 25.9164 21.456 26.544C22.0836 27.1717 22.3974 27.9262 22.3974 28.8077V35.7949C22.3974 36.6764 22.0836 37.4309 21.456 38.0585C20.8283 38.6862 20.0738 39 19.1923 39H12.2051Z" fill="currentColor"/>
        </svg>
        總覽
      </a>
    </li>
    <li> 
      <a href="./index.html" class="d-flex flex-column text-center text-decoration-none btn-nav-bottom">
        <svg width="49" height="48" viewBox="0 0 49 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M24.6558 33.0661C24.8563 33.0661 25.046 33.0339 25.2251 32.9695C25.4041 32.905 25.5724 32.8012 25.7299 32.658C26.446 32.0135 27.1979 31.3224 27.9857 30.5848C28.7734 29.8472 29.4931 29.0882 30.1447 28.3076C30.7964 27.527 31.3406 26.7465 31.7775 25.9659C32.2143 25.1854 32.4327 24.4299 32.4327 23.6994C32.4327 22.525 32.0209 21.5368 31.1974 20.7347C30.3739 19.9327 29.3678 19.5317 28.179 19.5317C27.4772 19.5317 26.8292 19.6749 26.2348 19.9613C25.6404 20.2478 25.1141 20.6345 24.6558 21.1214C24.2261 20.6345 23.6926 20.2478 23.0553 19.9613C22.4179 19.6749 21.7627 19.5317 21.0895 19.5317C19.9294 19.5317 18.9376 19.9327 18.1141 20.7347C17.2906 21.5368 16.8788 22.525 16.8788 23.6994C16.8788 24.4299 17.0972 25.1854 17.5341 25.9659C17.9709 26.7465 18.5151 27.527 19.1668 28.3076C19.8184 29.0882 20.5381 29.8472 21.3259 30.5848C22.1136 31.3224 22.8655 32.0135 23.5816 32.658C23.7391 32.8012 23.9074 32.905 24.0865 32.9695C24.2655 33.0339 24.4553 33.0661 24.6558 33.0661ZM14.666 38.974C13.7781 38.974 13.019 38.6589 12.3888 38.0288C11.7586 37.3986 11.4436 36.6395 11.4436 35.7515V22.346L9.25227 24.0002C8.89421 24.258 8.49677 24.3583 8.05994 24.301C7.62312 24.2437 7.26864 24.036 6.99652 23.6779C6.7244 23.3199 6.62057 22.9225 6.68502 22.4856C6.74947 22.0488 6.96072 21.6943 7.31877 21.4222L22.8512 9.67086C23.1376 9.45603 23.4491 9.29491 23.7857 9.18749C24.1223 9.08008 24.4624 9.02637 24.8061 9.02637C25.1499 9.02637 25.49 9.08366 25.8266 9.19823C26.1632 9.31281 26.4747 9.47752 26.7611 9.69235L42.0357 21.2718C42.3795 21.5439 42.5835 21.8984 42.648 22.3352C42.7124 22.7721 42.6086 23.1695 42.3365 23.5276C42.0644 23.8713 41.7099 24.0754 41.2731 24.1398C40.8362 24.2043 40.446 24.1005 40.1022 23.8283L38.1687 22.389V35.7515C38.1687 36.6395 37.8536 37.3986 37.2235 38.0288C36.5933 38.6589 35.8342 38.974 34.9462 38.974H14.666Z" fill="currentColor"/>
        </svg>
        首頁
      </a>
    </li>
    <li>
      <a href="javascript:void(0)" id="breathBtn" class="d-flex flex-column text-center text-decoration-none btn-nav-bottom ">
        <svg width="49" height="48" viewBox="0 0 49 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_2837_7522)">
        <path d="M35.5984 30.6101C35.5984 30.6101 35.5684 30.6101 35.5584 30.6101C35.0284 30.6101 34.5784 30.1901 34.5584 29.6501C34.5384 29.1001 34.9684 28.6301 35.5184 28.6101C37.2484 28.5301 38.7784 28.8901 39.9784 29.3401C40.2084 28.4301 40.3284 27.4901 40.3284 26.5501C39.2284 26.5201 37.8184 26.6501 36.3684 27.2401C36.2484 27.2901 36.1184 27.3201 35.9884 27.3201C35.5984 27.3201 35.2184 27.0901 35.0684 26.7001C34.8584 26.1901 35.0984 25.6101 35.6084 25.3901C37.2584 24.7101 38.8584 24.5301 40.1584 24.5401C39.9684 23.3701 39.5984 22.2101 39.0584 21.0801C39.6684 18.5301 39.8384 15.8301 39.5484 13.2501C39.2184 10.3901 38.3384 8.85014 36.9384 8.66014C36.8184 8.66014 36.6984 8.64014 36.5584 8.64014C34.8384 8.64014 32.6884 10.0301 31.1784 11.2001C30.5184 11.7201 29.8384 12.3801 29.2384 12.9701L29.1384 13.0601C27.5084 12.6001 25.8184 12.3601 24.1384 12.3601C23.5784 12.3601 23.0184 12.3901 22.4684 12.4401C21.4884 12.5301 20.4884 12.7201 19.4784 13.0001C18.9184 12.4701 18.2184 11.8001 17.4384 11.2001C15.9384 10.0301 13.7784 8.64014 12.0584 8.64014C11.9284 8.64014 11.7984 8.65014 11.6784 8.66014C9.57838 8.94014 9.19838 12.1901 9.07838 13.2501C8.77838 15.8201 8.94838 18.5401 9.56838 21.1101C9.03838 22.2201 8.68838 23.3701 8.49838 24.5501C9.81838 24.5201 11.4784 24.6801 13.2084 25.3901C13.7184 25.6001 13.9584 26.1801 13.7484 26.7001C13.5884 27.0901 13.2184 27.3201 12.8184 27.3201C12.6884 27.3201 12.5584 27.3001 12.4384 27.2401C10.9384 26.6201 9.45838 26.5101 8.33838 26.5501C8.33838 26.9901 8.35838 27.4301 8.40838 27.8601C8.46838 28.3801 8.57838 28.8801 8.69838 29.3901C9.90838 28.9201 11.4884 28.5401 13.2884 28.6101C13.8384 28.6301 14.2684 29.1001 14.2484 29.6501C14.2284 30.2001 13.7584 30.6701 13.2084 30.6101C11.6984 30.5501 10.3684 30.9001 9.34838 31.2901C10.0984 32.9801 11.2484 34.5001 12.7184 35.7401C15.4484 38.0401 19.6684 39.3501 24.3084 39.3501C29.5184 39.3501 34.2384 37.6601 36.9284 34.8201C37.9584 33.7401 38.7484 32.5301 39.3184 31.2501C38.3184 30.8801 37.0284 30.5601 35.5984 30.6101ZM12.9584 11.8401C11.8384 11.8401 11.5784 12.9701 11.4184 14.0301C11.2384 15.3401 11.2284 16.7401 11.3984 18.2001C11.1784 18.5001 10.9884 18.7701 10.7984 19.0201C10.7984 18.9301 10.7684 18.8401 10.7584 18.7401C10.7284 18.5401 10.6984 18.3401 10.6784 18.1501C10.4984 16.4301 10.5484 14.5201 10.8184 12.7701C11.1484 10.6101 11.6884 10.2801 11.8984 10.2401C11.9584 10.2301 12.0284 10.2201 12.0884 10.2201C12.7684 10.2201 13.7784 10.7801 14.1984 11.0201C15.3084 11.6401 16.4284 12.4701 17.6784 13.6201L16.7984 14.0301L16.7784 14.0001C16.0184 13.2101 15.0884 12.5401 14.2984 12.1901C13.7684 11.9501 13.3284 11.8401 12.9684 11.8401H12.9584ZM21.3584 28.0501C20.6984 28.8401 19.7484 29.2901 18.7484 29.2901C17.6584 29.2901 16.6884 28.7701 16.0784 27.8701C15.8584 27.5401 15.5884 26.8501 15.7984 26.3801C15.8684 26.2201 16.0184 26.0101 16.3584 25.9601C16.4284 25.9401 16.4984 25.9401 16.5684 25.9401C17.1284 25.9401 17.2684 26.3801 17.3584 26.6701C17.3884 26.7601 17.4184 26.8601 17.4484 26.9301C17.6884 27.4001 18.2184 27.6901 18.8184 27.6901C19.4184 27.6901 19.8884 27.4201 20.1284 26.9901C20.1684 26.9101 20.2084 26.8101 20.2384 26.7001C20.3484 26.4001 20.4984 25.9401 21.0484 25.9401C21.1184 25.9401 21.1884 25.9401 21.2684 25.9601C21.6284 26.0401 21.7784 26.2601 21.8484 26.4301C22.0384 26.9701 21.5984 27.7601 21.3584 28.0501ZM24.3284 35.2001C23.5184 35.2001 22.8684 34.3801 22.8684 33.3601C22.8684 32.3401 23.5184 31.5201 24.3284 31.5201C25.1384 31.5201 25.7884 32.3401 25.7884 33.3601C25.7884 34.3801 25.1284 35.2001 24.3284 35.2001ZM25.5784 29.9801C25.3884 30.1201 24.9884 30.3301 24.9884 30.3301C24.1684 30.4801 23.7884 30.2701 23.7884 30.2701C23.7884 30.2701 23.2984 30.0401 23.1284 29.8701C22.5584 29.3101 22.4084 28.1601 23.3684 27.9101C23.8784 27.7801 25.3484 27.7701 25.7884 28.0501C26.4884 28.5001 26.1284 29.5601 25.5784 29.9801ZM32.9484 27.3401C32.5484 28.5101 31.3884 29.2701 29.9984 29.2701C28.6084 29.2701 27.4184 28.5201 26.9884 27.3501C26.8684 27.0601 26.8084 26.6201 26.9884 26.3101C27.0884 26.1301 27.2584 26.0101 27.4784 25.9601C27.5584 25.9401 27.6484 25.9301 27.7184 25.9301C28.2584 25.9301 28.4384 26.3801 28.5584 26.7201C28.6284 26.8801 28.6884 27.0501 28.7884 27.1701C29.0684 27.5001 29.4984 27.6901 29.9584 27.6901C30.5284 27.6901 31.0284 27.4201 31.2984 26.9601C31.3384 26.8801 31.3784 26.7801 31.4184 26.6701C31.5284 26.3801 31.6884 25.9301 32.2184 25.9301C32.2884 25.9301 32.3684 25.9401 32.4484 25.9601C32.6584 26.0101 32.8284 26.1301 32.9384 26.3101C33.1084 26.6301 33.0584 27.0501 32.9584 27.3401H32.9484ZM31.8584 13.9901C31.8584 13.9901 31.8284 14.0101 31.8284 14.0301L30.9384 13.6201C32.1984 12.4701 33.3084 11.6401 34.4184 11.0201C34.8784 10.7601 35.8484 10.2201 36.5284 10.2201C36.5984 10.2201 36.6584 10.2201 36.7184 10.2401C37.1684 10.3301 37.5784 11.2701 37.7984 12.7701C38.0684 14.5201 38.1184 16.4301 37.9484 18.1501C37.9284 18.3401 37.8984 18.5301 37.8684 18.7301C37.8484 18.8101 37.8384 18.9001 37.8284 18.9801C37.7784 18.9301 37.7384 18.8701 37.6984 18.8101C37.5884 18.6701 37.4884 18.5401 37.3884 18.4301L37.2184 18.2001C37.3984 16.7301 37.3884 15.3301 37.1984 14.0301C37.0484 12.9701 36.7884 11.8401 35.6584 11.8401C35.2984 11.8401 34.8684 11.9501 34.3284 12.1901C33.5484 12.5401 32.6184 13.2101 31.8584 13.9901Z" fill="currentColor"/>
        </g>
        <defs>
        <clipPath id="clip0_2837_7522">
        <rect width="31.99" height="30.72" fill="white" transform="translate(8.33838 8.64014)"/>
        </clipPath>
        </defs>
        </svg>
        呼吸
      </a>
    </li>
    <li>
      <a href="./setting.html" class="d-flex flex-column text-center text-decoration-none btn-nav-bottom">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21.8411 40C21.2402 40 20.7178 39.7985 20.2739 39.3956C19.8301 38.9927 19.5671 38.4977 19.4852 37.9104L19.0755 34.8988C18.7204 34.7486 18.3618 34.5745 17.9999 34.3764C17.638 34.1784 17.3068 33.9701 17.0063 33.7516L14.1997 34.8988C13.6397 35.1447 13.0797 35.1686 12.5198 34.9706C11.9598 34.7725 11.5228 34.414 11.2086 33.895L9.01656 30.105C8.70244 29.586 8.61025 29.0329 8.74 28.4456C8.86974 27.8583 9.17363 27.3735 9.65165 26.991L12.11 25.1268C12.0827 24.9492 12.0691 24.7785 12.0691 24.6146V24.0205C12.0691 23.8566 12.0725 23.679 12.0793 23.4878C12.0861 23.2966 12.1032 23.0781 12.1305 22.8323L9.69262 21.0294C9.2146 20.647 8.9073 20.1656 8.77072 19.5851C8.63415 19.0047 8.72292 18.4481 9.03705 17.9155L11.2086 14.146C11.5228 13.627 11.9632 13.2685 12.53 13.0704C13.0968 12.8724 13.6602 12.8963 14.2201 13.1421L17.0678 14.3303C17.3409 14.1118 17.6448 13.907 17.9794 13.7157C18.314 13.5245 18.6794 13.347 19.0755 13.1831L19.4852 10.0896C19.5671 9.50235 19.8335 9.00726 20.2842 8.60435C20.7349 8.20145 21.2607 8 21.8616 8H26.1843C26.7852 8 27.3076 8.20145 27.7515 8.60435C28.1954 9.00726 28.4583 9.50235 28.5403 10.0896L28.95 13.1216C29.3324 13.2719 29.6841 13.446 30.005 13.644C30.326 13.8421 30.6367 14.0708 30.9372 14.3303L33.8258 13.1421C34.3858 12.8963 34.9457 12.8724 35.5057 13.0704C36.0656 13.2685 36.5027 13.627 36.8168 14.146L38.9884 17.9155C39.3025 18.4345 39.3913 18.9876 39.2547 19.5749C39.1181 20.1622 38.8108 20.647 38.3328 21.0294L35.7925 22.9142C35.8198 23.1054 35.8335 23.2796 35.8335 23.4366V24.6248C35.8335 24.7956 35.813 24.9697 35.772 25.1472L38.2714 26.991C38.7494 27.3735 39.0567 27.8583 39.1933 28.4456C39.3298 29.0329 39.2411 29.586 38.9269 30.105L36.7349 33.895C36.4207 34.414 35.9803 34.7725 35.4135 34.9706C34.8467 35.1686 34.2833 35.1447 33.7234 34.8988L30.9372 33.7106C30.6777 33.9155 30.3943 34.1067 30.087 34.2843C29.7797 34.4618 29.4007 34.6598 28.95 34.8784L28.5403 37.9104C28.4583 38.4977 28.1954 38.9927 27.7515 39.3956C27.3076 39.7985 26.7852 40 26.1843 40H21.8411ZM23.9922 29.5519C25.5219 29.5519 26.8262 29.0124 27.9052 27.9334C28.9841 26.8545 29.5236 25.5501 29.5236 24.0205C29.5236 22.4908 28.9841 21.1865 27.9052 20.1076C26.8262 19.0286 25.5219 18.4891 23.9922 18.4891C22.4489 18.4891 21.1412 19.0286 20.0691 20.1076C18.9969 21.1865 18.4609 22.4908 18.4609 24.0205C18.4609 25.5501 18.9969 26.8545 20.0691 27.9334C21.1412 29.0124 22.4489 29.5519 23.9922 29.5519Z" fill="currentColor"/>
        </svg>
        設定
      </a>
    </li>
    <li>
      <a href="https://snoesugar.github.io/Mofu-Diary/login.html">註冊頁</a>
    </li>
        <!-- 上拉選單 (一開始隱藏) -->
    <div class="bottom-sheet" id="breathSheet">
      <div class="sheet-header">
        <button type="button" class="btn-close" id="breathClose" aria-label="Close"><img src="data:image/svg+xml,%3csvg%20width='12'%20height='12'%20viewBox='0%200%2012%2012'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10.2937%200.29441C10.6842%20-0.0961836%2011.3173%20-0.0961837%2011.7078%200.29441C12.0979%200.68495%2012.0979%201.31796%2011.7078%201.70847L7.41287%206.00339L11.7%2010.2915C12.0901%2010.682%2012.0901%2011.315%2011.7%2011.7055C11.3095%2012.0961%2010.6764%2012.0961%2010.2859%2011.7055L5.99978%207.41746L1.71365%2011.7055C1.3232%2012.0961%200.690042%2012.0961%200.299588%2011.7055C-0.0905491%2011.315%20-0.090633%2010.682%200.299588%2010.2915L4.58572%206.00339L0.291775%201.70847C-0.0985827%201.31792%20-0.0985384%200.684988%200.291775%200.29441C0.682236%20-0.0961775%201.31538%20-0.0961775%201.70584%200.29441L5.99978%204.58933L10.2937%200.29441Z'%20fill='%23BC8035'/%3e%3c/svg%3e" alt=""></button>
      </div>
      <div class="sheet-content ">
        <img src="/Mofu-Diary/assets/breathCard-tcyKfBJ5.png" alt="呼吸圖片1" class="  ">
        <!-- 上方紅框：三個點點 -->
        <div class="dots d-flex justify-content-center align-items-center mb-4 mt-4">
          <span class="dot small"></span>
          <span class="dot big mx-2"></span>
          <span class="dot small"></span>
        </div>
        <div>
          <h5 class="fw-bold text-primary-700 fs-9 mb-3" >平衡呼吸法</h5>
          <span class="text-primary-700 fs-12 border border-neutral-100 rounded-m px-2 py-1 ">呼吸頻率 1:1</span>
          <p class="text-primary-700 fs-12 mt-3">日常練習適用<br>平衡自律神經與預防壓力</p>
        </div>
        <!--練習時長 -->
        <div class="duration-box text-center p-3 mb-5">
          <p class=" d-flex align-items-center justify-content-center"><span class="fw-medium fs-12  text-primary-700">練習時長</span> <span class="highlight fw-10 text-primary-700 fw-bold px-6px">3</span> <span  class="fw-medium fs-12  text-primary-700">分鐘</span></p>
          <div class="ticks d-flex justify-content-center align-items-center">
            <!-- 用小刻度表示 -->
            <span class="tick"></span>
            <span class="tick"></span>
            <span class="tick"></span>
            <span class="tick"></span>
            <span class="tick active"></span>
            <span class="tick"></span>
            <span class="tick"></span>
            <span class="tick"></span>
            <span class="tick"></span>
          </div>
        </div>  
        <a href="https://snoesugar.github.io/Mofu-Diary/breathing-exercises-1.html" class="text-decoration-none border  border-primary-700 text-primary-700 fs-11 fw-medium d-block w-100 btn-py-13-5 rounded-pill">開始呼吸</a> 
      </div>
    </div>
  </ul>
</div>
<script>
    // JS 控制展開收合
  const breathBtn = document.getElementById('breathBtn');
  const breathSheet = document.getElementById('breathSheet');
  const breathClose = document.getElementById('breathClose');

  breathBtn.addEventListener('click', () => {
    breathSheet.classList.toggle('active'); // 點擊切換顯示/隱藏
  });
  // 點擊 X 關閉
  breathClose.addEventListener('click', () => {
    breathSheet.classList.remove('active');
  });
</script>  </div>
</aside>
    

<!--保持footer維持primary-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // 找到底部的「總覽」按鈕 (第一個)
    const navBtns = document.querySelectorAll(".btn-nav-bottom");
    if (navBtns.length > 0) {
      navBtns[1].classList.add("active");  // 讓第一個變 active
    }
  });

  /* ▲ 進出場位置計算：收合=只露 52px 頭，展開=停在問候區塊底下 */
  (function(){
    const root  = document.documentElement;
    const panel = document.getElementById('relaxPanel');
    const OPEN_GAP = 8; // 問候區塊底下預留的間距（可微調）

    function px(n){ return Math.round(n) + 'px'; }

    function measure(){
      const scene = document.querySelector('.bg-scene');
      const greet = document.getElementById('greet');
      const head  = panel?.querySelector('.scene-footer');
      if(!scene || !greet || !head || !panel) return;

      const headH = Math.round(head.offsetHeight || 52);
      root.style.setProperty('--panel-head-h', px(headH));

      const sb = scene.getBoundingClientRect();
      const gb = greet.getBoundingClientRect();

      // ▲ 收合：抽屜 top = 背景頂 + 背景高 - 抽屜頭高
      const collapsedTop = Math.round(sb.top + sb.height - headH);

      // ▲ 展開：抽屜 top = 問候區塊底 + gap
      const openTop = Math.max(0, Math.round(gb.bottom + OPEN_GAP));

      panel.dataset.collapsedTop = collapsedTop;
      panel.dataset.openTop = openTop;

      // 依目前狀態套用
      const isOpen = panel.classList.contains('is-open');
      root.style.setProperty('--panel-top', px(isOpen ? openTop : collapsedTop));
    }

    const applyState = () => {
      const t = panel.classList.contains('is-open') ? panel.dataset.openTop : panel.dataset.collapsedTop;
      document.documentElement.classList.toggle('panel-open', panel.classList.contains('is-open'));
      if(t) root.style.setProperty('--panel-top', px(+t));
    };

    // 初始 / 變更時重算
    ['DOMContentLoaded','load','resize'].forEach(evt => window.addEventListener(evt, measure));

    // ▲ 點擊抽屜頭切換
    document.addEventListener('click', (e) => {
      if(!e.target.closest('.tag-btn')) return;
      panel.classList.toggle('is-open');
      measure();      // ← 切換時重算（若 header 高度有變動）
      applyState();
    });
  })();
</script>
  </body>
</html>
